import * as fs from "fs/promises";
import * as http from "http";
import * as https from "https";
import { URL, URLSearchParams } from "url";
import { CredentialProvider } from "./CredentialProvider.mjs";
import { Credentials } from "./Credentials.mjs";
import { parseXml } from "./internal/helper.mjs";
import { request } from "./internal/request.mjs";
import { readAsString } from "./internal/response.mjs";
export class IamAwsProvider extends CredentialProvider {
  accessExpiresAt = '';
  constructor({
    customEndpoint = undefined,
    transportAgent = undefined
  }) {
    super({
      accessKey: '',
      secretKey: ''
    });
    this.customEndpoint = customEndpoint;
    this.transportAgent = transportAgent;

    /**
     * Internal Tracking variables
     */
    this._credentials = null;
  }
  async getCredentials() {
    if (!this._credentials || this.isAboutToExpire()) {
      this._credentials = await this.fetchCredentials();
    }
    return this._credentials;
  }
  async fetchCredentials() {
    try {
      // check for IRSA (https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html)
      const tokenFile = process.env.AWS_WEB_IDENTITY_TOKEN_FILE;
      if (tokenFile) {
        return await this.fetchCredentialsUsingTokenFile(tokenFile);
      }

      // try with IAM role for EC2 instances (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html)
      let tokenHeader = 'Authorization';
      let token = process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN;
      const relativeUri = process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI;
      const fullUri = process.env.AWS_CONTAINER_CREDENTIALS_FULL_URI;
      let url;
      if (relativeUri) {
        url = new URL(relativeUri, 'http://169.254.170.2');
      } else if (fullUri) {
        url = new URL(fullUri);
      } else {
        token = await this.fetchImdsToken();
        tokenHeader = 'X-aws-ec2-metadata-token';
        url = await this.getIamRoleNamedUrl(token);
      }
      return this.requestCredentials(url, tokenHeader, token);
    } catch (err) {
      throw new Error(`Failed to get Credentials: ${err}`, {
        cause: err
      });
    }
  }
  async fetchCredentialsUsingTokenFile(tokenFile) {
    const token = await fs.readFile(tokenFile, {
      encoding: 'utf8'
    });
    const region = process.env.AWS_REGION;
    const stsEndpoint = new URL(region ? `https://sts.${region}.amazonaws.com` : 'https://sts.amazonaws.com');
    const hostValue = stsEndpoint.hostname;
    const portValue = stsEndpoint.port;
    const qryParams = new URLSearchParams({
      Action: 'AssumeRoleWithWebIdentity',
      Version: '2011-06-15'
    });
    const roleArn = process.env.AWS_ROLE_ARN;
    if (roleArn) {
      qryParams.set('RoleArn', roleArn);
      const roleSessionName = process.env.AWS_ROLE_SESSION_NAME;
      qryParams.set('RoleSessionName', roleSessionName ? roleSessionName : Date.now().toString());
    }
    qryParams.set('WebIdentityToken', token);
    qryParams.sort();
    const requestOptions = {
      hostname: hostValue,
      port: portValue,
      path: `${stsEndpoint.pathname}?${qryParams.toString()}`,
      protocol: stsEndpoint.protocol,
      method: 'POST',
      headers: {},
      agent: this.transportAgent
    };
    const transport = stsEndpoint.protocol === 'http:' ? http : https;
    const res = await request(transport, requestOptions, null);
    const body = await readAsString(res);
    const assumeRoleResponse = parseXml(body);
    const creds = assumeRoleResponse.AssumeRoleWithWebIdentityResponse.AssumeRoleWithWebIdentityResult.Credentials;
    this.accessExpiresAt = creds.Expiration;
    return new Credentials({
      accessKey: creds.AccessKeyId,
      secretKey: creds.SecretAccessKey,
      sessionToken: creds.SessionToken
    });
  }
  async fetchImdsToken() {
    const endpoint = this.customEndpoint ? this.customEndpoint : 'http://169.254.169.254';
    const url = new URL('/latest/api/token', endpoint);
    const requestOptions = {
      hostname: url.hostname,
      port: url.port,
      path: `${url.pathname}${url.search}`,
      protocol: url.protocol,
      method: 'PUT',
      headers: {
        'X-aws-ec2-metadata-token-ttl-seconds': '21600'
      },
      agent: this.transportAgent
    };
    const transport = url.protocol === 'http:' ? http : https;
    const res = await request(transport, requestOptions, null);
    return await readAsString(res);
  }
  async getIamRoleNamedUrl(token) {
    const endpoint = this.customEndpoint ? this.customEndpoint : 'http://169.254.169.254';
    const url = new URL('latest/meta-data/iam/security-credentials/', endpoint);
    const roleName = await this.getIamRoleName(url, token);
    return new URL(`${url.pathname}/${encodeURIComponent(roleName)}`, url.origin);
  }
  async getIamRoleName(url, token) {
    const requestOptions = {
      hostname: url.hostname,
      port: url.port,
      path: `${url.pathname}${url.search}`,
      protocol: url.protocol,
      method: 'GET',
      headers: {
        'X-aws-ec2-metadata-token': token
      },
      agent: this.transportAgent
    };
    const transport = url.protocol === 'http:' ? http : https;
    const res = await request(transport, requestOptions, null);
    const body = await readAsString(res);
    const roleNames = body.split(/\r\n|[\n\r\u2028\u2029]/);
    if (roleNames.length === 0) {
      throw new Error(`No IAM roles attached to EC2 service ${url}`);
    }
    return roleNames[0];
  }
  async requestCredentials(url, tokenHeader, token) {
    const headers = {};
    if (token) {
      headers[tokenHeader] = token;
    }
    const requestOptions = {
      hostname: url.hostname,
      port: url.port,
      path: `${url.pathname}${url.search}`,
      protocol: url.protocol,
      method: 'GET',
      headers: headers,
      agent: this.transportAgent
    };
    const transport = url.protocol === 'http:' ? http : https;
    const res = await request(transport, requestOptions, null);
    const body = await readAsString(res);
    const ecsCredentials = JSON.parse(body);
    if (!ecsCredentials.Code || ecsCredentials.Code != 'Success') {
      throw new Error(`${url} failed with code ${ecsCredentials.Code} and message ${ecsCredentials.Message}`);
    }
    this.accessExpiresAt = ecsCredentials.Expiration;
    return new Credentials({
      accessKey: ecsCredentials.AccessKeyID,
      secretKey: ecsCredentials.SecretAccessKey,
      sessionToken: ecsCredentials.Token
    });
  }
  isAboutToExpire() {
    const expiresAt = new Date(this.accessExpiresAt);
    const provisionalExpiry = new Date(Date.now() + 1000 * 10); // 10 seconds leeway
    return provisionalExpiry > expiresAt;
  }
}

// deprecated default export, please use named exports.
// keep for backward compatibility.
// eslint-disable-next-line import/no-default-export
export default IamAwsProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsImh0dHAiLCJodHRwcyIsIlVSTCIsIlVSTFNlYXJjaFBhcmFtcyIsIkNyZWRlbnRpYWxQcm92aWRlciIsIkNyZWRlbnRpYWxzIiwicGFyc2VYbWwiLCJyZXF1ZXN0IiwicmVhZEFzU3RyaW5nIiwiSWFtQXdzUHJvdmlkZXIiLCJhY2Nlc3NFeHBpcmVzQXQiLCJjb25zdHJ1Y3RvciIsImN1c3RvbUVuZHBvaW50IiwidW5kZWZpbmVkIiwidHJhbnNwb3J0QWdlbnQiLCJhY2Nlc3NLZXkiLCJzZWNyZXRLZXkiLCJfY3JlZGVudGlhbHMiLCJnZXRDcmVkZW50aWFscyIsImlzQWJvdXRUb0V4cGlyZSIsImZldGNoQ3JlZGVudGlhbHMiLCJ0b2tlbkZpbGUiLCJwcm9jZXNzIiwiZW52IiwiQVdTX1dFQl9JREVOVElUWV9UT0tFTl9GSUxFIiwiZmV0Y2hDcmVkZW50aWFsc1VzaW5nVG9rZW5GaWxlIiwidG9rZW5IZWFkZXIiLCJ0b2tlbiIsIkFXU19DT05UQUlORVJfQVVUSE9SSVpBVElPTl9UT0tFTiIsInJlbGF0aXZlVXJpIiwiQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19SRUxBVElWRV9VUkkiLCJmdWxsVXJpIiwiQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19GVUxMX1VSSSIsInVybCIsImZldGNoSW1kc1Rva2VuIiwiZ2V0SWFtUm9sZU5hbWVkVXJsIiwicmVxdWVzdENyZWRlbnRpYWxzIiwiZXJyIiwiRXJyb3IiLCJjYXVzZSIsInJlYWRGaWxlIiwiZW5jb2RpbmciLCJyZWdpb24iLCJBV1NfUkVHSU9OIiwic3RzRW5kcG9pbnQiLCJob3N0VmFsdWUiLCJob3N0bmFtZSIsInBvcnRWYWx1ZSIsInBvcnQiLCJxcnlQYXJhbXMiLCJBY3Rpb24iLCJWZXJzaW9uIiwicm9sZUFybiIsIkFXU19ST0xFX0FSTiIsInNldCIsInJvbGVTZXNzaW9uTmFtZSIsIkFXU19ST0xFX1NFU1NJT05fTkFNRSIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsInNvcnQiLCJyZXF1ZXN0T3B0aW9ucyIsInBhdGgiLCJwYXRobmFtZSIsInByb3RvY29sIiwibWV0aG9kIiwiaGVhZGVycyIsImFnZW50IiwidHJhbnNwb3J0IiwicmVzIiwiYm9keSIsImFzc3VtZVJvbGVSZXNwb25zZSIsImNyZWRzIiwiQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3BvbnNlIiwiQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3VsdCIsIkV4cGlyYXRpb24iLCJBY2Nlc3NLZXlJZCIsIlNlY3JldEFjY2Vzc0tleSIsInNlc3Npb25Ub2tlbiIsIlNlc3Npb25Ub2tlbiIsImVuZHBvaW50Iiwic2VhcmNoIiwicm9sZU5hbWUiLCJnZXRJYW1Sb2xlTmFtZSIsImVuY29kZVVSSUNvbXBvbmVudCIsIm9yaWdpbiIsInJvbGVOYW1lcyIsInNwbGl0IiwibGVuZ3RoIiwiZWNzQ3JlZGVudGlhbHMiLCJKU09OIiwicGFyc2UiLCJDb2RlIiwiTWVzc2FnZSIsIkFjY2Vzc0tleUlEIiwiVG9rZW4iLCJleHBpcmVzQXQiLCJwcm92aXNpb25hbEV4cGlyeSJdLCJzb3VyY2VzIjpbIklhbUF3c1Byb3ZpZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ25vZGU6ZnMvcHJvbWlzZXMnXHJcbmltcG9ydCAqIGFzIGh0dHAgZnJvbSAnbm9kZTpodHRwJ1xyXG5pbXBvcnQgKiBhcyBodHRwcyBmcm9tICdub2RlOmh0dHBzJ1xyXG5pbXBvcnQgeyBVUkwsIFVSTFNlYXJjaFBhcmFtcyB9IGZyb20gJ25vZGU6dXJsJ1xyXG5cclxuaW1wb3J0IHsgQ3JlZGVudGlhbFByb3ZpZGVyIH0gZnJvbSAnLi9DcmVkZW50aWFsUHJvdmlkZXIudHMnXHJcbmltcG9ydCB7IENyZWRlbnRpYWxzIH0gZnJvbSAnLi9DcmVkZW50aWFscy50cydcclxuaW1wb3J0IHsgcGFyc2VYbWwgfSBmcm9tICcuL2ludGVybmFsL2hlbHBlci50cydcclxuaW1wb3J0IHsgcmVxdWVzdCB9IGZyb20gJy4vaW50ZXJuYWwvcmVxdWVzdC50cydcclxuaW1wb3J0IHsgcmVhZEFzU3RyaW5nIH0gZnJvbSAnLi9pbnRlcm5hbC9yZXNwb25zZS50cydcclxuXHJcbmludGVyZmFjZSBBc3N1bWVSb2xlUmVzcG9uc2Uge1xyXG4gIEFzc3VtZVJvbGVXaXRoV2ViSWRlbnRpdHlSZXNwb25zZToge1xyXG4gICAgQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3VsdDoge1xyXG4gICAgICBDcmVkZW50aWFsczoge1xyXG4gICAgICAgIEFjY2Vzc0tleUlkOiBzdHJpbmdcclxuICAgICAgICBTZWNyZXRBY2Nlc3NLZXk6IHN0cmluZ1xyXG4gICAgICAgIFNlc3Npb25Ub2tlbjogc3RyaW5nXHJcbiAgICAgICAgRXhwaXJhdGlvbjogc3RyaW5nXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBFY3NDcmVkZW50aWFscyB7XHJcbiAgQWNjZXNzS2V5SUQ6IHN0cmluZ1xyXG4gIFNlY3JldEFjY2Vzc0tleTogc3RyaW5nXHJcbiAgVG9rZW46IHN0cmluZ1xyXG4gIEV4cGlyYXRpb246IHN0cmluZ1xyXG4gIENvZGU6IHN0cmluZ1xyXG4gIE1lc3NhZ2U6IHN0cmluZ1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElhbUF3c1Byb3ZpZGVyT3B0aW9ucyB7XHJcbiAgY3VzdG9tRW5kcG9pbnQ/OiBzdHJpbmdcclxuICB0cmFuc3BvcnRBZ2VudD86IGh0dHAuQWdlbnRcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIElhbUF3c1Byb3ZpZGVyIGV4dGVuZHMgQ3JlZGVudGlhbFByb3ZpZGVyIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGN1c3RvbUVuZHBvaW50Pzogc3RyaW5nXHJcblxyXG4gIHByaXZhdGUgX2NyZWRlbnRpYWxzOiBDcmVkZW50aWFscyB8IG51bGxcclxuICBwcml2YXRlIHJlYWRvbmx5IHRyYW5zcG9ydEFnZW50PzogaHR0cC5BZ2VudFxyXG4gIHByaXZhdGUgYWNjZXNzRXhwaXJlc0F0ID0gJydcclxuXHJcbiAgY29uc3RydWN0b3IoeyBjdXN0b21FbmRwb2ludCA9IHVuZGVmaW5lZCwgdHJhbnNwb3J0QWdlbnQgPSB1bmRlZmluZWQgfTogSWFtQXdzUHJvdmlkZXJPcHRpb25zKSB7XHJcbiAgICBzdXBlcih7IGFjY2Vzc0tleTogJycsIHNlY3JldEtleTogJycgfSlcclxuXHJcbiAgICB0aGlzLmN1c3RvbUVuZHBvaW50ID0gY3VzdG9tRW5kcG9pbnRcclxuICAgIHRoaXMudHJhbnNwb3J0QWdlbnQgPSB0cmFuc3BvcnRBZ2VudFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW50ZXJuYWwgVHJhY2tpbmcgdmFyaWFibGVzXHJcbiAgICAgKi9cclxuICAgIHRoaXMuX2NyZWRlbnRpYWxzID0gbnVsbFxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q3JlZGVudGlhbHMoKTogUHJvbWlzZTxDcmVkZW50aWFscz4ge1xyXG4gICAgaWYgKCF0aGlzLl9jcmVkZW50aWFscyB8fCB0aGlzLmlzQWJvdXRUb0V4cGlyZSgpKSB7XHJcbiAgICAgIHRoaXMuX2NyZWRlbnRpYWxzID0gYXdhaXQgdGhpcy5mZXRjaENyZWRlbnRpYWxzKClcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLl9jcmVkZW50aWFsc1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBmZXRjaENyZWRlbnRpYWxzKCk6IFByb21pc2U8Q3JlZGVudGlhbHM+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIGNoZWNrIGZvciBJUlNBIChodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vZWtzL2xhdGVzdC91c2VyZ3VpZGUvaWFtLXJvbGVzLWZvci1zZXJ2aWNlLWFjY291bnRzLmh0bWwpXHJcbiAgICAgIGNvbnN0IHRva2VuRmlsZSA9IHByb2Nlc3MuZW52LkFXU19XRUJfSURFTlRJVFlfVE9LRU5fRklMRVxyXG4gICAgICBpZiAodG9rZW5GaWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZmV0Y2hDcmVkZW50aWFsc1VzaW5nVG9rZW5GaWxlKHRva2VuRmlsZSlcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdHJ5IHdpdGggSUFNIHJvbGUgZm9yIEVDMiBpbnN0YW5jZXMgKGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BV1NFQzIvbGF0ZXN0L1VzZXJHdWlkZS9pYW0tcm9sZXMtZm9yLWFtYXpvbi1lYzIuaHRtbClcclxuICAgICAgbGV0IHRva2VuSGVhZGVyID0gJ0F1dGhvcml6YXRpb24nXHJcbiAgICAgIGxldCB0b2tlbiA9IHByb2Nlc3MuZW52LkFXU19DT05UQUlORVJfQVVUSE9SSVpBVElPTl9UT0tFTlxyXG4gICAgICBjb25zdCByZWxhdGl2ZVVyaSA9IHByb2Nlc3MuZW52LkFXU19DT05UQUlORVJfQ1JFREVOVElBTFNfUkVMQVRJVkVfVVJJXHJcbiAgICAgIGNvbnN0IGZ1bGxVcmkgPSBwcm9jZXNzLmVudi5BV1NfQ09OVEFJTkVSX0NSRURFTlRJQUxTX0ZVTExfVVJJXHJcbiAgICAgIGxldCB1cmw6IFVSTFxyXG4gICAgICBpZiAocmVsYXRpdmVVcmkpIHtcclxuICAgICAgICB1cmwgPSBuZXcgVVJMKHJlbGF0aXZlVXJpLCAnaHR0cDovLzE2OS4yNTQuMTcwLjInKVxyXG4gICAgICB9IGVsc2UgaWYgKGZ1bGxVcmkpIHtcclxuICAgICAgICB1cmwgPSBuZXcgVVJMKGZ1bGxVcmkpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdG9rZW4gPSBhd2FpdCB0aGlzLmZldGNoSW1kc1Rva2VuKClcclxuICAgICAgICB0b2tlbkhlYWRlciA9ICdYLWF3cy1lYzItbWV0YWRhdGEtdG9rZW4nXHJcbiAgICAgICAgdXJsID0gYXdhaXQgdGhpcy5nZXRJYW1Sb2xlTmFtZWRVcmwodG9rZW4pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3RDcmVkZW50aWFscyh1cmwsIHRva2VuSGVhZGVyLCB0b2tlbilcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgQ3JlZGVudGlhbHM6ICR7ZXJyfWAsIHsgY2F1c2U6IGVyciB9KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBmZXRjaENyZWRlbnRpYWxzVXNpbmdUb2tlbkZpbGUodG9rZW5GaWxlOiBzdHJpbmcpOiBQcm9taXNlPENyZWRlbnRpYWxzPiB7XHJcbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGZzLnJlYWRGaWxlKHRva2VuRmlsZSwgeyBlbmNvZGluZzogJ3V0ZjgnIH0pXHJcbiAgICBjb25zdCByZWdpb24gPSBwcm9jZXNzLmVudi5BV1NfUkVHSU9OXHJcbiAgICBjb25zdCBzdHNFbmRwb2ludCA9IG5ldyBVUkwocmVnaW9uID8gYGh0dHBzOi8vc3RzLiR7cmVnaW9ufS5hbWF6b25hd3MuY29tYCA6ICdodHRwczovL3N0cy5hbWF6b25hd3MuY29tJylcclxuXHJcbiAgICBjb25zdCBob3N0VmFsdWUgPSBzdHNFbmRwb2ludC5ob3N0bmFtZVxyXG4gICAgY29uc3QgcG9ydFZhbHVlID0gc3RzRW5kcG9pbnQucG9ydFxyXG4gICAgY29uc3QgcXJ5UGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcbiAgICAgIEFjdGlvbjogJ0Fzc3VtZVJvbGVXaXRoV2ViSWRlbnRpdHknLFxyXG4gICAgICBWZXJzaW9uOiAnMjAxMS0wNi0xNScsXHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnN0IHJvbGVBcm4gPSBwcm9jZXNzLmVudi5BV1NfUk9MRV9BUk5cclxuICAgIGlmIChyb2xlQXJuKSB7XHJcbiAgICAgIHFyeVBhcmFtcy5zZXQoJ1JvbGVBcm4nLCByb2xlQXJuKVxyXG4gICAgICBjb25zdCByb2xlU2Vzc2lvbk5hbWUgPSBwcm9jZXNzLmVudi5BV1NfUk9MRV9TRVNTSU9OX05BTUVcclxuICAgICAgcXJ5UGFyYW1zLnNldCgnUm9sZVNlc3Npb25OYW1lJywgcm9sZVNlc3Npb25OYW1lID8gcm9sZVNlc3Npb25OYW1lIDogRGF0ZS5ub3coKS50b1N0cmluZygpKVxyXG4gICAgfVxyXG5cclxuICAgIHFyeVBhcmFtcy5zZXQoJ1dlYklkZW50aXR5VG9rZW4nLCB0b2tlbilcclxuICAgIHFyeVBhcmFtcy5zb3J0KClcclxuXHJcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgaG9zdG5hbWU6IGhvc3RWYWx1ZSxcclxuICAgICAgcG9ydDogcG9ydFZhbHVlLFxyXG4gICAgICBwYXRoOiBgJHtzdHNFbmRwb2ludC5wYXRobmFtZX0/JHtxcnlQYXJhbXMudG9TdHJpbmcoKX1gLFxyXG4gICAgICBwcm90b2NvbDogc3RzRW5kcG9pbnQucHJvdG9jb2wsXHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7fSxcclxuICAgICAgYWdlbnQ6IHRoaXMudHJhbnNwb3J0QWdlbnQsXHJcbiAgICB9IHNhdGlzZmllcyBodHRwLlJlcXVlc3RPcHRpb25zXHJcblxyXG4gICAgY29uc3QgdHJhbnNwb3J0ID0gc3RzRW5kcG9pbnQucHJvdG9jb2wgPT09ICdodHRwOicgPyBodHRwIDogaHR0cHNcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QodHJhbnNwb3J0LCByZXF1ZXN0T3B0aW9ucywgbnVsbClcclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZWFkQXNTdHJpbmcocmVzKVxyXG5cclxuICAgIGNvbnN0IGFzc3VtZVJvbGVSZXNwb25zZTogQXNzdW1lUm9sZVJlc3BvbnNlID0gcGFyc2VYbWwoYm9keSlcclxuICAgIGNvbnN0IGNyZWRzID0gYXNzdW1lUm9sZVJlc3BvbnNlLkFzc3VtZVJvbGVXaXRoV2ViSWRlbnRpdHlSZXNwb25zZS5Bc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5UmVzdWx0LkNyZWRlbnRpYWxzXHJcbiAgICB0aGlzLmFjY2Vzc0V4cGlyZXNBdCA9IGNyZWRzLkV4cGlyYXRpb25cclxuICAgIHJldHVybiBuZXcgQ3JlZGVudGlhbHMoe1xyXG4gICAgICBhY2Nlc3NLZXk6IGNyZWRzLkFjY2Vzc0tleUlkLFxyXG4gICAgICBzZWNyZXRLZXk6IGNyZWRzLlNlY3JldEFjY2Vzc0tleSxcclxuICAgICAgc2Vzc2lvblRva2VuOiBjcmVkcy5TZXNzaW9uVG9rZW4sXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBmZXRjaEltZHNUb2tlbigpIHtcclxuICAgIGNvbnN0IGVuZHBvaW50ID0gdGhpcy5jdXN0b21FbmRwb2ludCA/IHRoaXMuY3VzdG9tRW5kcG9pbnQgOiAnaHR0cDovLzE2OS4yNTQuMTY5LjI1NCdcclxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoJy9sYXRlc3QvYXBpL3Rva2VuJywgZW5kcG9pbnQpXHJcblxyXG4gICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XHJcbiAgICAgIGhvc3RuYW1lOiB1cmwuaG9zdG5hbWUsXHJcbiAgICAgIHBvcnQ6IHVybC5wb3J0LFxyXG4gICAgICBwYXRoOiBgJHt1cmwucGF0aG5hbWV9JHt1cmwuc2VhcmNofWAsXHJcbiAgICAgIHByb3RvY29sOiB1cmwucHJvdG9jb2wsXHJcbiAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnWC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuLXR0bC1zZWNvbmRzJzogJzIxNjAwJyxcclxuICAgICAgfSxcclxuICAgICAgYWdlbnQ6IHRoaXMudHJhbnNwb3J0QWdlbnQsXHJcbiAgICB9IHNhdGlzZmllcyBodHRwLlJlcXVlc3RPcHRpb25zXHJcblxyXG4gICAgY29uc3QgdHJhbnNwb3J0ID0gdXJsLnByb3RvY29sID09PSAnaHR0cDonID8gaHR0cCA6IGh0dHBzXHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KHRyYW5zcG9ydCwgcmVxdWVzdE9wdGlvbnMsIG51bGwpXHJcbiAgICByZXR1cm4gYXdhaXQgcmVhZEFzU3RyaW5nKHJlcylcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0SWFtUm9sZU5hbWVkVXJsKHRva2VuOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGVuZHBvaW50ID0gdGhpcy5jdXN0b21FbmRwb2ludCA/IHRoaXMuY3VzdG9tRW5kcG9pbnQgOiAnaHR0cDovLzE2OS4yNTQuMTY5LjI1NCdcclxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoJ2xhdGVzdC9tZXRhLWRhdGEvaWFtL3NlY3VyaXR5LWNyZWRlbnRpYWxzLycsIGVuZHBvaW50KVxyXG5cclxuICAgIGNvbnN0IHJvbGVOYW1lID0gYXdhaXQgdGhpcy5nZXRJYW1Sb2xlTmFtZSh1cmwsIHRva2VuKVxyXG4gICAgcmV0dXJuIG5ldyBVUkwoYCR7dXJsLnBhdGhuYW1lfS8ke2VuY29kZVVSSUNvbXBvbmVudChyb2xlTmFtZSl9YCwgdXJsLm9yaWdpbilcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0SWFtUm9sZU5hbWUodXJsOiBVUkwsIHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XHJcbiAgICAgIGhvc3RuYW1lOiB1cmwuaG9zdG5hbWUsXHJcbiAgICAgIHBvcnQ6IHVybC5wb3J0LFxyXG4gICAgICBwYXRoOiBgJHt1cmwucGF0aG5hbWV9JHt1cmwuc2VhcmNofWAsXHJcbiAgICAgIHByb3RvY29sOiB1cmwucHJvdG9jb2wsXHJcbiAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnWC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuJzogdG9rZW4sXHJcbiAgICAgIH0sXHJcbiAgICAgIGFnZW50OiB0aGlzLnRyYW5zcG9ydEFnZW50LFxyXG4gICAgfSBzYXRpc2ZpZXMgaHR0cC5SZXF1ZXN0T3B0aW9uc1xyXG5cclxuICAgIGNvbnN0IHRyYW5zcG9ydCA9IHVybC5wcm90b2NvbCA9PT0gJ2h0dHA6JyA/IGh0dHAgOiBodHRwc1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh0cmFuc3BvcnQsIHJlcXVlc3RPcHRpb25zLCBudWxsKVxyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlYWRBc1N0cmluZyhyZXMpXHJcbiAgICBjb25zdCByb2xlTmFtZXMgPSBib2R5LnNwbGl0KC9cXHJcXG58W1xcblxcclxcdTIwMjhcXHUyMDI5XS8pXHJcbiAgICBpZiAocm9sZU5hbWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIElBTSByb2xlcyBhdHRhY2hlZCB0byBFQzIgc2VydmljZSAke3VybH1gKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJvbGVOYW1lc1swXSBhcyBzdHJpbmdcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcmVxdWVzdENyZWRlbnRpYWxzKHVybDogVVJMLCB0b2tlbkhlYWRlcjogc3RyaW5nLCB0b2tlbjogc3RyaW5nIHwgdW5kZWZpbmVkKTogUHJvbWlzZTxDcmVkZW50aWFscz4ge1xyXG4gICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9XHJcbiAgICBpZiAodG9rZW4pIHtcclxuICAgICAgaGVhZGVyc1t0b2tlbkhlYWRlcl0gPSB0b2tlblxyXG4gICAgfVxyXG4gICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XHJcbiAgICAgIGhvc3RuYW1lOiB1cmwuaG9zdG5hbWUsXHJcbiAgICAgIHBvcnQ6IHVybC5wb3J0LFxyXG4gICAgICBwYXRoOiBgJHt1cmwucGF0aG5hbWV9JHt1cmwuc2VhcmNofWAsXHJcbiAgICAgIHByb3RvY29sOiB1cmwucHJvdG9jb2wsXHJcbiAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXHJcbiAgICAgIGFnZW50OiB0aGlzLnRyYW5zcG9ydEFnZW50LFxyXG4gICAgfSBzYXRpc2ZpZXMgaHR0cC5SZXF1ZXN0T3B0aW9uc1xyXG5cclxuICAgIGNvbnN0IHRyYW5zcG9ydCA9IHVybC5wcm90b2NvbCA9PT0gJ2h0dHA6JyA/IGh0dHAgOiBodHRwc1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh0cmFuc3BvcnQsIHJlcXVlc3RPcHRpb25zLCBudWxsKVxyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlYWRBc1N0cmluZyhyZXMpXHJcbiAgICBjb25zdCBlY3NDcmVkZW50aWFscyA9IEpTT04ucGFyc2UoYm9keSkgYXMgRWNzQ3JlZGVudGlhbHNcclxuICAgIGlmICghZWNzQ3JlZGVudGlhbHMuQ29kZSB8fCBlY3NDcmVkZW50aWFscy5Db2RlICE9ICdTdWNjZXNzJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dXJsfSBmYWlsZWQgd2l0aCBjb2RlICR7ZWNzQ3JlZGVudGlhbHMuQ29kZX0gYW5kIG1lc3NhZ2UgJHtlY3NDcmVkZW50aWFscy5NZXNzYWdlfWApXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hY2Nlc3NFeHBpcmVzQXQgPSBlY3NDcmVkZW50aWFscy5FeHBpcmF0aW9uXHJcbiAgICByZXR1cm4gbmV3IENyZWRlbnRpYWxzKHtcclxuICAgICAgYWNjZXNzS2V5OiBlY3NDcmVkZW50aWFscy5BY2Nlc3NLZXlJRCxcclxuICAgICAgc2VjcmV0S2V5OiBlY3NDcmVkZW50aWFscy5TZWNyZXRBY2Nlc3NLZXksXHJcbiAgICAgIHNlc3Npb25Ub2tlbjogZWNzQ3JlZGVudGlhbHMuVG9rZW4sXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0Fib3V0VG9FeHBpcmUoKSB7XHJcbiAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZSh0aGlzLmFjY2Vzc0V4cGlyZXNBdClcclxuICAgIGNvbnN0IHByb3Zpc2lvbmFsRXhwaXJ5ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDEwMDAgKiAxMCkgLy8gMTAgc2Vjb25kcyBsZWV3YXlcclxuICAgIHJldHVybiBwcm92aXNpb25hbEV4cGlyeSA+IGV4cGlyZXNBdFxyXG4gIH1cclxufVxyXG5cclxuLy8gZGVwcmVjYXRlZCBkZWZhdWx0IGV4cG9ydCwgcGxlYXNlIHVzZSBuYW1lZCBleHBvcnRzLlxyXG4vLyBrZWVwIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LlxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWRlZmF1bHQtZXhwb3J0XHJcbmV4cG9ydCBkZWZhdWx0IElhbUF3c1Byb3ZpZGVyXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLQSxFQUFFO0FBQ2QsT0FBTyxLQUFLQyxJQUFJO0FBQ2hCLE9BQU8sS0FBS0MsS0FBSztBQUNqQixTQUFTQyxHQUFHLEVBQUVDLGVBQWU7QUFFN0IsU0FBU0Msa0JBQWtCLFFBQVEsMEJBQXlCO0FBQzVELFNBQVNDLFdBQVcsUUFBUSxtQkFBa0I7QUFDOUMsU0FBU0MsUUFBUSxRQUFRLHVCQUFzQjtBQUMvQyxTQUFTQyxPQUFPLFFBQVEsd0JBQXVCO0FBQy9DLFNBQVNDLFlBQVksUUFBUSx5QkFBd0I7QUE2QnJELE9BQU8sTUFBTUMsY0FBYyxTQUFTTCxrQkFBa0IsQ0FBQztFQUs3Q00sZUFBZSxHQUFHLEVBQUU7RUFFNUJDLFdBQVdBLENBQUM7SUFBRUMsY0FBYyxHQUFHQyxTQUFTO0lBQUVDLGNBQWMsR0FBR0Q7RUFBaUMsQ0FBQyxFQUFFO0lBQzdGLEtBQUssQ0FBQztNQUFFRSxTQUFTLEVBQUUsRUFBRTtNQUFFQyxTQUFTLEVBQUU7SUFBRyxDQUFDLENBQUM7SUFFdkMsSUFBSSxDQUFDSixjQUFjLEdBQUdBLGNBQWM7SUFDcEMsSUFBSSxDQUFDRSxjQUFjLEdBQUdBLGNBQWM7O0lBRXBDO0FBQ0o7QUFDQTtJQUNJLElBQUksQ0FBQ0csWUFBWSxHQUFHLElBQUk7RUFDMUI7RUFFQSxNQUFNQyxjQUFjQSxDQUFBLEVBQXlCO0lBQzNDLElBQUksQ0FBQyxJQUFJLENBQUNELFlBQVksSUFBSSxJQUFJLENBQUNFLGVBQWUsQ0FBQyxDQUFDLEVBQUU7TUFDaEQsSUFBSSxDQUFDRixZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUNHLGdCQUFnQixDQUFD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QUcsQ0FBQ2EsUUFBUTtNQUN0QkUsSUFBSSxFQUFFZixHQUFHLENBQUNlLElBQUk7TUFDZGMsSUFBSSxFQUFFLEdBQUc3QixHQUFHLENBQUM4QixRQUFRLEdBQUc5QixHQUFHLENBQUNnRCxNQUFNLEVBQUU7TUFDcENqQixRQUFRLEVBQUUvQixHQUFHLENBQUMrQixRQUFRO01BQ3RCQyxNQUFNLEVBQUUsS0FBSztNQUNiQyxPQUFPLEVBQUVBLE9BQU87TUFDaEJDLEtBQUssRUFBRSxJQUFJLENBQUNyRDtJQUNkLENBQStCO0lBRS9CLE1BQU1zRCxTQUFTLEdBQUduQyxHQUFHLENBQUMrQixRQUFRLEtBQUssT0FBTyxHQUFHaEUsSUFBSSxHQUFHQyxLQUFLO0lBQ3pELE1BQU1vRSxHQUFHLEdBQUcsTUFBTTlELE9BQU8sQ0FBQzZELFNBQVMsRUFBRVAsY0FBYyxFQUFFLElBQUksQ0FBQztJQUMxRCxNQUFNUyxJQUFJLEdBQUcsTUFBTTlELFlBQVksQ0FBQzZELEdBQUcsQ0FBQztJQUNwQyxNQUFNb0IsY0FBYyxHQUFHQyxJQUFJLENBQUNDLEtBQUssQ0FBQ3JCLElBQUksQ0FBbUI7SUFDekQsSUFBSSxDQUFDbUIsY0FBYyxDQUFDRyxJQUFJLElBQUlILGNBQWMsQ0FBQ0csSUFBSSxJQUFJLFNBQVMsRUFBRTtNQUM1RCxNQUFNLElBQUl0RCxLQUFLLENBQUMsR0FBR0wsR0FBRyxxQkFBcUJ3RCxjQUFjLENBQUNHLElBQUksZ0JBQWdCSCxjQUFjLENBQUNJLE9BQU8sRUFBRSxDQUFDO0lBQ3pHO0lBRUEsSUFBSSxDQUFDbkYsZUFBZSxHQUFHK0UsY0FBYyxDQUFDZCxVQUFVO0lBQ2hELE9BQU8sSUFBSXRFLFdBQVcsQ0FBQztNQUNyQlUsU0FBUyxFQUFFMEUsY0FBYyxDQUFDSyxXQUFXO01BQ3JDOUUsU0FBUyxFQUFFeUUsY0FBYyxDQUFDWixlQUFlO01BQ3pDQyxZQUFZLEVBQUVXLGNBQWMsQ0FBQ007SUFDL0IsQ0FBQyxDQUFDO0VBQ0o7RUFFUTVFLGVBQWVBLENBQUEsRUFBRztJQUN4QixNQUFNNkUsU0FBUyxHQUFHLElBQUl2QyxJQUFJLENBQUMsSUFBSSxDQUFDL0MsZUFBZSxDQUFDO0lBQ2hELE1BQU11RixpQkFBaUIsR0FBRyxJQUFJeEMsSUFBSSxDQUFDQSxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQyxFQUFDO0lBQzNELE9BQU91QyxpQkFBaUIsR0FBR0QsU0FBUztFQUN0QztBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWV2RixjQUFjIiwiaWdub3JlTGlzdCI6W119