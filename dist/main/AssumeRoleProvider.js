"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var http = _interopRequireWildcard(require("http"), true);
var https = _interopRequireWildcard(require("https"), true);
var _url = require("url");
var _CredentialProvider = require("./CredentialProvider.js");
var _Credentials = require("./Credentials.js");
var _helper = require("./internal/helper.js");
var _request = require("./internal/request.js");
var _response = require("./internal/response.js");
var _signing = require("./signing.js");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
/**
 * @see https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html
 */

const defaultExpirySeconds = 900;
class AssumeRoleProvider extends _CredentialProvider.CredentialProvider {
  accessExpiresAt = '';
  constructor({
    stsEndpoint,
    accessKey,
    secretKey,
    durationSeconds = defaultExpirySeconds,
    sessionToken,
    policy,
    region = '',
    roleArn,
    roleSessionName,
    externalId,
    token,
    webIdentityToken,
    action = 'AssumeRole',
    transportAgent = undefined
  }) {
    super({
      accessKey,
      secretKey,
      sessionToken
    });
    this.stsEndpoint = new _url.URL(stsEndpoint);
    this.accessKey = accessKey;
    this.secretKey = secretKey;
    this.policy = policy;
    this.region = region;
    this.roleArn = roleArn;
    this.roleSessionName = roleSessionName;
    this.externalId = externalId;
    this.token = token;
    this.webIdentityToken = webIdentityToken;
    this.action = action;
    this.durationSeconds = parseInt(durationSeconds);
    let expirySeconds = this.durationSeconds;
    if (this.durationSeconds < defaultExpirySeconds) {
      expirySeconds = defaultExpirySeconds;
    }
    this.expirySeconds = expirySeconds; // for calculating refresh of credentials.

    // By default, nodejs uses a global agent if the 'agent' property
    // is set to undefined. Otherwise, it's okay to assume the users
    // know what they're doing if they specify a custom transport agent.
    this.transportAgent = transportAgent;
    const isHttp = this.stsEndpoint.protocol === 'http:';
    this.transport = isHttp ? http : https;

    /**
     * Internal Tracking variables
     */
    this._credentials = null;
  }
  getRequestConfig() {
    const hostValue = this.stsEndpoint.hostname;
    const portValue = this.stsEndpoint.port;
    const qryParams = new _url.URLSearchParams({
      Action: this.action,
      Version: '2011-06-15'
    });
    qryParams.set('DurationSeconds', this.expirySeconds.toString());
    if (this.policy) {
      qryParams.set('Policy', this.policy);
    }
    if (this.roleArn) {
      qryParams.set('RoleArn', this.roleArn);
    }
    if (this.roleSessionName != null) {
      qryParams.set('RoleSessionName', this.roleSessionName);
    }
    if (this.token != null) {
      qryParams.set('Token', this.token);
    }
    if (this.webIdentityToken) {
      qryParams.set('WebIdentityToken', this.webIdentityToken);
    }
    if (this.externalId) {
      qryParams.set('ExternalId', this.externalId);
    }
    const urlParams = qryParams.toString();
    const contentSha256 = (0, _helper.toSha256)(urlParams);
    const date = new Date();
    const requestOptions = {
      hostname: hostValue,
      port: portValue,
      path: '/',
      protocol: this.stsEndpoint.protocol,
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'content-length': urlParams.length.toString(),
        host: hostValue,
        'x-amz-date': (0, _helper.makeDateLong)(date),
        'x-amz-content-sha256': contentSha256
      },
      agent: this.transportAgent
    };
    requestOptions.headers.authorization = (0, _signing.signV4ByServiceName)(requestOptions, this.accessKey, this.secretKey, this.region, date, contentSha256, 'sts');
    return {
      requestOptions,
      requestData: urlParams
    };
  }
  async performRequest() {
    const {
      requestOptions,
      requestData
    } = this.getRequestConfig();
    const res = await (0, _request.request)(this.transport, requestOptions, requestData);
    const body = await (0, _response.readAsString)(res);
    return (0, _helper.parseXml)(body);
  }
  parseCredentials(respObj) {
    if (respObj.ErrorResponse) {
      var _respObj$ErrorRespons, _respObj$ErrorRespons2;
      throw new Error(`Unable to obtain credentials: ${(_respObj$ErrorRespons = respObj.ErrorResponse) === null || _respObj$ErrorRespons === void 0 || (_respObj$ErrorRespons = _respObj$ErrorRespons.Error) === null || _respObj$ErrorRespons === void 0 ? void 0 : _respObj$ErrorRespons.Code} ${(_respObj$ErrorRespons2 = respObj.ErrorResponse) === null || _respObj$ErrorRespons2 === void 0 || (_respObj$ErrorRespons2 = _respObj$ErrorRespons2.Error) === null || _respObj$ErrorRespons2 === void 0 ? void 0 : _respObj$ErrorRespons2.Message}`, {
        cause: respObj
      });
    }
    const {
      AssumeRoleResponse: {
        AssumeRoleResult: {
          Credentials: {
            AccessKeyId: accessKey,
            SecretAccessKey: secretKey,
            SessionToken: sessionToken,
            Expiration: expiresAt
          }
        }
      }
    } = respObj;
    this.accessExpiresAt = expiresAt;
    return new _Credentials.Credentials({
      accessKey,
      secretKey,
      sessionToken
    });
  }
  async refreshCredentials() {
    try {
      const assumeRoleCredentials = await this.performRequest();
      this._credentials = this.parseCredentials(assumeRoleCredentials);
    } catch (err) {
      throw new Error(`Failed to get Credentials: ${err}`, {
        cause: err
      });
    }
    return this._credentials;
  }
  async getCredentials() {
    if (this._credentials && !this.isAboutToExpire()) {
      return this._credentials;
    }
    this._credentials = await this.refreshCredentials();
    return this._credentials;
  }
  isAboutToExpire() {
    const expiresAt = new Date(this.accessExpiresAt);
    const provisionalExpiry = new Date(Date.now() + 1000 * 10); // check before 10 seconds.
    return provisionalExpiry > expiresAt;
  }
}

// deprecated default export, please use named exports.
// keep for backward compatibility.
// eslint-disable-next-line import/no-default-export
exports.AssumeRoleProvider = AssumeRoleProvider;
var _default = exports.default = AssumeRoleProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJodHRwIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiaHR0cHMiLCJfdXJsIiwiX0NyZWRlbnRpYWxQcm92aWRlciIsIl9DcmVkZW50aWFscyIsIl9oZWxwZXIiLCJfcmVxdWVzdCIsIl9yZXNwb25zZSIsIl9zaWduaW5nIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZGVmYXVsdEV4cGlyeVNlY29uZHMiLCJBc3N1bWVSb2xlUHJvdmlkZXIiLCJDcmVkZW50aWFsUHJvdmlkZXIiLCJhY2Nlc3NFeHBpcmVzQXQiLCJjb25zdHJ1Y3RvciIsInN0c0VuZHBvaW50IiwiYWNjZXNzS2V5Iiwic2VjcmV0S2V5IiwiZHVyYXRpb25TZWNvbmRzIiwic2Vzc2lvblRva2VuIiwicG9saWN5IiwicmVnaW9uIiwicm9sZUFybiIsInJvbGVTZXNzaW9uTmFtZSIsImV4dGVybmFsSWQiLCJ0b2tlbiIsIndlYklkZW50aXR5VG9rZW4iLCJhY3Rpb24iLCJ0cmFuc3BvcnRBZ2VudCIsInVuZGVmaW5lZCIsIlVSTCIsInBhcnNlSW50IiwiZXhwaXJ5U2Vjb25kcyIsImlzSHR0cCIsInByb3RvY29sIiwidHJhbnNwb3J0IiwiX2NyZWRlbnRpYWxzIiwiZ2V0UmVxdWVzdENvbmZpZyIsImhvc3RWYWx1ZSIsImhvc3RuYW1lIiwicG9ydFZhbHVlIiwicG9ydCIsInFyeVBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsIkFjdGlvbiIsIlZlcnNpb24iLCJ0b1N0cmluZyIsInVybFBhcmFtcyIsImNvbnRlbnRTaGEyNTYiLCJ0b1NoYTI1NiIsImRhdGUiLCJEYXRlIiwicmVxdWVzdE9wdGlvbnMiLCJwYXRoIiwibWV0aG9kIiwiaGVhZGVycyIsImxlbmd0aCIsImhvc3QiLCJtYWtlRGF0ZUxvbmciLCJhZ2VudCIsImF1dGhvcml6YXRpb24iLCJzaWduVjRCeVNlcnZpY2VOYW1lIiwicmVxdWVzdERhdGEiLCJwZXJmb3JtUmVxdWVzdCIsInJlcyIsInJlcXVlc3QiLCJib2R5IiwicmVhZEFzU3RyaW5nIiwicGFyc2VYbWwiLCJwYXJzZUNyZWRlbnRpYWxzIiwicmVzcE9iaiIsIkVycm9yUmVzcG9uc2UiLCJfcmVzcE9iaiRFcnJvclJlc3BvbnMiLCJfcmVzcE9iaiRFcnJvclJlc3BvbnMyIiwiRXJyb3IiLCJDb2RlIiwiTWVzc2FnZSIsImNhdXNlIiwiQXNzdW1lUm9sZVJlc3BvbnNlIiwiQXNzdW1lUm9sZVJlc3VsdCIsIkNyZWRlbnRpYWxzIiwiQWNjZXNzS2V5SWQiLCJTZWNyZXRBY2Nlc3NLZXkiLCJTZXNzaW9uVG9rZW4iLCJFeHBpcmF0aW9uIiwiZXhwaXJlc0F0IiwicmVmcmVzaENyZWRlbnRpYWxzIiwiYXNzdW1lUm9sZUNyZWRlbnRpYWxzIiwiZXJyIiwiZ2V0Q3JlZGVudGlhbHMiLCJpc0Fib3V0VG9FeHBpcmUiLCJwcm92aXNpb25hbEV4cGlyeSIsIm5vdyIsImV4cG9ydHMiLCJfZGVmYXVsdCJdLCJzb3VyY2VzIjpbIkFzc3VtZVJvbGVQcm92aWRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBodHRwIGZyb20gJ25vZGU6aHR0cCdcclxuaW1wb3J0ICogYXMgaHR0cHMgZnJvbSAnbm9kZTpodHRwcydcclxuaW1wb3J0IHsgVVJMLCBVUkxTZWFyY2hQYXJhbXMgfSBmcm9tICdub2RlOnVybCdcclxuXHJcbmltcG9ydCB7IENyZWRlbnRpYWxQcm92aWRlciB9IGZyb20gJy4vQ3JlZGVudGlhbFByb3ZpZGVyLnRzJ1xyXG5pbXBvcnQgeyBDcmVkZW50aWFscyB9IGZyb20gJy4vQ3JlZGVudGlhbHMudHMnXHJcbmltcG9ydCB7IG1ha2VEYXRlTG9uZywgcGFyc2VYbWwsIHRvU2hhMjU2IH0gZnJvbSAnLi9pbnRlcm5hbC9oZWxwZXIudHMnXHJcbmltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuL2ludGVybmFsL3JlcXVlc3QudHMnXHJcbmltcG9ydCB7IHJlYWRBc1N0cmluZyB9IGZyb20gJy4vaW50ZXJuYWwvcmVzcG9uc2UudHMnXHJcbmltcG9ydCB0eXBlIHsgVHJhbnNwb3J0IH0gZnJvbSAnLi9pbnRlcm5hbC90eXBlLnRzJ1xyXG5pbXBvcnQgeyBzaWduVjRCeVNlcnZpY2VOYW1lIH0gZnJvbSAnLi9zaWduaW5nLnRzJ1xyXG5cclxuLyoqXHJcbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL1NUUy9sYXRlc3QvQVBJUmVmZXJlbmNlL0FQSV9Bc3N1bWVSb2xlLmh0bWxcclxuICovXHJcbnR5cGUgQ3JlZGVudGlhbFJlc3BvbnNlID0ge1xyXG4gIEVycm9yUmVzcG9uc2U/OiB7XHJcbiAgICBFcnJvcj86IHtcclxuICAgICAgQ29kZT86IHN0cmluZ1xyXG4gICAgICBNZXNzYWdlPzogc3RyaW5nXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBBc3N1bWVSb2xlUmVzcG9uc2U6IHtcclxuICAgIEFzc3VtZVJvbGVSZXN1bHQ6IHtcclxuICAgICAgQ3JlZGVudGlhbHM6IHtcclxuICAgICAgICBBY2Nlc3NLZXlJZDogc3RyaW5nXHJcbiAgICAgICAgU2VjcmV0QWNjZXNzS2V5OiBzdHJpbmdcclxuICAgICAgICBTZXNzaW9uVG9rZW46IHN0cmluZ1xyXG4gICAgICAgIEV4cGlyYXRpb246IHN0cmluZ1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFzc3VtZVJvbGVQcm92aWRlck9wdGlvbnMge1xyXG4gIHN0c0VuZHBvaW50OiBzdHJpbmdcclxuICBhY2Nlc3NLZXk6IHN0cmluZ1xyXG4gIHNlY3JldEtleTogc3RyaW5nXHJcbiAgZHVyYXRpb25TZWNvbmRzPzogbnVtYmVyXHJcbiAgc2Vzc2lvblRva2VuPzogc3RyaW5nXHJcbiAgcG9saWN5Pzogc3RyaW5nXHJcbiAgcmVnaW9uPzogc3RyaW5nXHJcbiAgcm9sZUFybj86IHN0cmluZ1xyXG4gIHJvbGVTZXNzaW9uTmFtZT86IHN0cmluZ1xyXG4gIGV4dGVybmFsSWQ/OiBzdHJpbmdcclxuICB0b2tlbj86IHN0cmluZ1xyXG4gIHdlYklkZW50aXR5VG9rZW4/OiBzdHJpbmdcclxuICBhY3Rpb24/OiBzdHJpbmdcclxuICB0cmFuc3BvcnRBZ2VudD86IGh0dHAuQWdlbnRcclxufVxyXG5cclxuY29uc3QgZGVmYXVsdEV4cGlyeVNlY29uZHMgPSA5MDBcclxuXHJcbmV4cG9ydCBjbGFzcyBBc3N1bWVSb2xlUHJvdmlkZXIgZXh0ZW5kcyBDcmVkZW50aWFsUHJvdmlkZXIge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3RzRW5kcG9pbnQ6IFVSTFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYWNjZXNzS2V5OiBzdHJpbmdcclxuICBwcml2YXRlIHJlYWRvbmx5IHNlY3JldEtleTogc3RyaW5nXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkdXJhdGlvblNlY29uZHM6IG51bWJlclxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcG9saWN5Pzogc3RyaW5nXHJcbiAgcHJpdmF0ZSByZWFkb25seSByZWdpb246IHN0cmluZ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcm9sZUFybj86IHN0cmluZ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcm9sZVNlc3Npb25OYW1lPzogc3RyaW5nXHJcbiAgcHJpdmF0ZSByZWFkb25seSBleHRlcm5hbElkPzogc3RyaW5nXHJcbiAgcHJpdmF0ZSByZWFkb25seSB0b2tlbj86IHN0cmluZ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgd2ViSWRlbnRpdHlUb2tlbj86IHN0cmluZ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYWN0aW9uOiBzdHJpbmdcclxuXHJcbiAgcHJpdmF0ZSBfY3JlZGVudGlhbHM6IENyZWRlbnRpYWxzIHwgbnVsbFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZXhwaXJ5U2Vjb25kczogbnVtYmVyXHJcbiAgcHJpdmF0ZSBhY2Nlc3NFeHBpcmVzQXQgPSAnJ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhbnNwb3J0QWdlbnQ/OiBodHRwLkFnZW50XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhbnNwb3J0OiBUcmFuc3BvcnRcclxuXHJcbiAgY29uc3RydWN0b3Ioe1xyXG4gICAgc3RzRW5kcG9pbnQsXHJcbiAgICBhY2Nlc3NLZXksXHJcbiAgICBzZWNyZXRLZXksXHJcbiAgICBkdXJhdGlvblNlY29uZHMgPSBkZWZhdWx0RXhwaXJ5U2Vjb25kcyxcclxuICAgIHNlc3Npb25Ub2tlbixcclxuICAgIHBvbGljeSxcclxuICAgIHJlZ2lvbiA9ICcnLFxyXG4gICAgcm9sZUFybixcclxuICAgIHJvbGVTZXNzaW9uTmFtZSxcclxuICAgIGV4dGVybmFsSWQsXHJcbiAgICB0b2tlbixcclxuICAgIHdlYklkZW50aXR5VG9rZW4sXHJcbiAgICBhY3Rpb24gPSAnQXNzdW1lUm9sZScsXHJcbiAgICB0cmFuc3BvcnRBZ2VudCA9IHVuZGVmaW5lZCxcclxuICB9OiBBc3N1bWVSb2xlUHJvdmlkZXJPcHRpb25zKSB7XHJcbiAgICBzdXBlcih7IGFjY2Vzc0tleSwgc2VjcmV0S2V5LCBzZXNzaW9uVG9rZW4gfSlcclxuXHJcbiAgICB0aGlzLnN0c0VuZHBvaW50ID0gbmV3IFVSTChzdHNFbmRwb2ludClcclxuICAgIHRoaXMuYWNjZXNzS2V5ID0gYWNjZXNzS2V5XHJcbiAgICB0aGlzLnNlY3JldEtleSA9IHNlY3JldEtleVxyXG4gICAgdGhpcy5wb2xpY3kgPSBwb2xpY3lcclxuICAgIHRoaXMucmVnaW9uID0gcmVnaW9uXHJcbiAgICB0aGlzLnJvbGVBcm4gPSByb2xlQXJuXHJcbiAgICB0aGlzLnJvbGVTZXNzaW9uTmFtZSA9IHJvbGVTZXNzaW9uTmFtZVxyXG4gICAgdGhpcy5leHRlcm5hbElkID0gZXh0ZXJuYWxJZFxyXG4gICAgdGhpcy50b2tlbiA9IHRva2VuXHJcbiAgICB0aGlzLndlYklkZW50aXR5VG9rZW4gPSB3ZWJJZGVudGl0eVRva2VuXHJcbiAgICB0aGlzLmFjdGlvbiA9IGFjdGlvblxyXG5cclxuICAgIHRoaXMuZHVyYXRpb25TZWNvbmRzID0gcGFyc2VJbnQoZHVyYXRpb25TZWNvbmRzIGFzIHVua25vd24gYXMgc3RyaW5nKVxyXG5cclxuICAgIGxldCBleHBpcnlTZWNvbmRzID0gdGhpcy5kdXJhdGlvblNlY29uZHNcclxuICAgIGlmICh0aGlzLmR1cmF0aW9uU2Vjb25kcyA8IGRlZmF1bHRFeHBpcnlTZWNvbmRzKSB7XHJcbiAgICAgIGV4cGlyeVNlY29uZHMgPSBkZWZhdWx0RXhwaXJ5U2Vjb25kc1xyXG4gICAgfVxyXG4gICAgdGhpcy5leHBpcnlTZWNvbmRzID0gZXhwaXJ5U2Vjb25kcyAvLyBmb3IgY2FsY3VsYXRpbmcgcmVmcmVzaCBvZiBjcmVkZW50aWFscy5cclxuXHJcbiAgICAvLyBCeSBkZWZhdWx0LCBub2RlanMgdXNlcyBhIGdsb2JhbCBhZ2VudCBpZiB0aGUgJ2FnZW50JyBwcm9wZXJ0eVxyXG4gICAgLy8gaXMgc2V0IHRvIHVuZGVmaW5lZC4gT3RoZXJ3aXNlLCBpdCdzIG9rYXkgdG8gYXNzdW1lIHRoZSB1c2Vyc1xyXG4gICAgLy8ga25vdyB3aGF0IHRoZXkncmUgZG9pbmcgaWYgdGhleSBzcGVjaWZ5IGEgY3VzdG9tIHRyYW5zcG9ydCBhZ2VudC5cclxuICAgIHRoaXMudHJhbnNwb3J0QWdlbnQgPSB0cmFuc3BvcnRBZ2VudFxyXG4gICAgY29uc3QgaXNIdHRwOiBib29sZWFuID0gdGhpcy5zdHNFbmRwb2ludC5wcm90b2NvbCA9PT0gJ2h0dHA6J1xyXG4gICAgdGhpcy50cmFuc3BvcnQgPSBpc0h0dHAgPyBodHRwIDogaHR0cHNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEludGVybmFsIFRyYWNraW5nIHZhcmlhYmxlc1xyXG4gICAgICovXHJcbiAgICB0aGlzLl9jcmVkZW50aWFscyA9IG51bGxcclxuICB9XHJcblxyXG4gIGdldFJlcXVlc3RDb25maWcoKToge1xyXG4gICAgcmVxdWVzdE9wdGlvbnM6IGh0dHAuUmVxdWVzdE9wdGlvbnNcclxuICAgIHJlcXVlc3REYXRhOiBzdHJpbmdcclxuICB9IHtcclxuICAgIGNvbnN0IGhvc3RWYWx1ZSA9IHRoaXMuc3RzRW5kcG9pbnQuaG9zdG5hbWVcclxuICAgIGNvbnN0IHBvcnRWYWx1ZSA9IHRoaXMuc3RzRW5kcG9pbnQucG9ydFxyXG4gICAgY29uc3QgcXJ5UGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7IEFjdGlvbjogdGhpcy5hY3Rpb24sIFZlcnNpb246ICcyMDExLTA2LTE1JyB9KVxyXG5cclxuICAgIHFyeVBhcmFtcy5zZXQoJ0R1cmF0aW9uU2Vjb25kcycsIHRoaXMuZXhwaXJ5U2Vjb25kcy50b1N0cmluZygpKVxyXG5cclxuICAgIGlmICh0aGlzLnBvbGljeSkge1xyXG4gICAgICBxcnlQYXJhbXMuc2V0KCdQb2xpY3knLCB0aGlzLnBvbGljeSlcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnJvbGVBcm4pIHtcclxuICAgICAgcXJ5UGFyYW1zLnNldCgnUm9sZUFybicsIHRoaXMucm9sZUFybilcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5yb2xlU2Vzc2lvbk5hbWUgIT0gbnVsbCkge1xyXG4gICAgICBxcnlQYXJhbXMuc2V0KCdSb2xlU2Vzc2lvbk5hbWUnLCB0aGlzLnJvbGVTZXNzaW9uTmFtZSlcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnRva2VuICE9IG51bGwpIHtcclxuICAgICAgcXJ5UGFyYW1zLnNldCgnVG9rZW4nLCB0aGlzLnRva2VuKVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLndlYklkZW50aXR5VG9rZW4pIHtcclxuICAgICAgcXJ5UGFyYW1zLnNldCgnV2ViSWRlbnRpdHlUb2tlbicsIHRoaXMud2ViSWRlbnRpdHlUb2tlbilcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5leHRlcm5hbElkKSB7XHJcbiAgICAgIHFyeVBhcmFtcy5zZXQoJ0V4dGVybmFsSWQnLCB0aGlzLmV4dGVybmFsSWQpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXJsUGFyYW1zID0gcXJ5UGFyYW1zLnRvU3RyaW5nKClcclxuICAgIGNvbnN0IGNvbnRlbnRTaGEyNTYgPSB0b1NoYTI1Nih1cmxQYXJhbXMpXHJcblxyXG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKClcclxuXHJcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgaG9zdG5hbWU6IGhvc3RWYWx1ZSxcclxuICAgICAgcG9ydDogcG9ydFZhbHVlLFxyXG4gICAgICBwYXRoOiAnLycsXHJcbiAgICAgIHByb3RvY29sOiB0aGlzLnN0c0VuZHBvaW50LnByb3RvY29sLFxyXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcclxuICAgICAgICAnY29udGVudC1sZW5ndGgnOiB1cmxQYXJhbXMubGVuZ3RoLnRvU3RyaW5nKCksXHJcbiAgICAgICAgaG9zdDogaG9zdFZhbHVlLFxyXG4gICAgICAgICd4LWFtei1kYXRlJzogbWFrZURhdGVMb25nKGRhdGUpLFxyXG4gICAgICAgICd4LWFtei1jb250ZW50LXNoYTI1Nic6IGNvbnRlbnRTaGEyNTYsXHJcbiAgICAgIH0gYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPixcclxuICAgICAgYWdlbnQ6IHRoaXMudHJhbnNwb3J0QWdlbnQsXHJcbiAgICB9IHNhdGlzZmllcyBodHRwLlJlcXVlc3RPcHRpb25zXHJcblxyXG4gICAgcmVxdWVzdE9wdGlvbnMuaGVhZGVycy5hdXRob3JpemF0aW9uID0gc2lnblY0QnlTZXJ2aWNlTmFtZShcclxuICAgICAgcmVxdWVzdE9wdGlvbnMsXHJcbiAgICAgIHRoaXMuYWNjZXNzS2V5LFxyXG4gICAgICB0aGlzLnNlY3JldEtleSxcclxuICAgICAgdGhpcy5yZWdpb24sXHJcbiAgICAgIGRhdGUsXHJcbiAgICAgIGNvbnRlbnRTaGEyNTYsXHJcbiAgICAgICdzdHMnLFxyXG4gICAgKVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlcXVlc3RPcHRpb25zLFxyXG4gICAgICByZXF1ZXN0RGF0YTogdXJsUGFyYW1zLFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcGVyZm9ybVJlcXVlc3QoKTogUHJvbWlzZTxDcmVkZW50aWFsUmVzcG9uc2U+IHtcclxuICAgIGNvbnN0IHsgcmVxdWVzdE9wdGlvbnMsIHJlcXVlc3REYXRhIH0gPSB0aGlzLmdldFJlcXVlc3RDb25maWcoKVxyXG5cclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QodGhpcy50cmFuc3BvcnQsIHJlcXVlc3RPcHRpb25zLCByZXF1ZXN0RGF0YSlcclxuXHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVhZEFzU3RyaW5nKHJlcylcclxuXHJcbiAgICByZXR1cm4gcGFyc2VYbWwoYm9keSlcclxuICB9XHJcblxyXG4gIHBhcnNlQ3JlZGVudGlhbHMocmVzcE9iajogQ3JlZGVudGlhbFJlc3BvbnNlKTogQ3JlZGVudGlhbHMge1xyXG4gICAgaWYgKHJlc3BPYmouRXJyb3JSZXNwb25zZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgYFVuYWJsZSB0byBvYnRhaW4gY3JlZGVudGlhbHM6ICR7cmVzcE9iai5FcnJvclJlc3BvbnNlPy5FcnJvcj8uQ29kZX0gJHtyZXNwT2JqLkVycm9yUmVzcG9uc2U/LkVycm9yPy5NZXNzYWdlfWAsXHJcbiAgICAgICAgeyBjYXVzZTogcmVzcE9iaiB9LFxyXG4gICAgICApXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qge1xyXG4gICAgICBBc3N1bWVSb2xlUmVzcG9uc2U6IHtcclxuICAgICAgICBBc3N1bWVSb2xlUmVzdWx0OiB7XHJcbiAgICAgICAgICBDcmVkZW50aWFsczoge1xyXG4gICAgICAgICAgICBBY2Nlc3NLZXlJZDogYWNjZXNzS2V5LFxyXG4gICAgICAgICAgICBTZWNyZXRBY2Nlc3NLZXk6IHNlY3JldEtleSxcclxuICAgICAgICAgICAgU2Vzc2lvblRva2VuOiBzZXNzaW9uVG9rZW4sXHJcbiAgICAgICAgICAgIEV4cGlyYXRpb246IGV4cGlyZXNBdCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgIH0gPSByZXNwT2JqXHJcblxyXG4gICAgdGhpcy5hY2Nlc3NFeHBpcmVzQXQgPSBleHBpcmVzQXRcclxuXHJcbiAgICByZXR1cm4gbmV3IENyZWRlbnRpYWxzKHsgYWNjZXNzS2V5LCBzZWNyZXRLZXksIHNlc3Npb25Ub2tlbiB9KVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVmcmVzaENyZWRlbnRpYWxzKCk6IFByb21pc2U8Q3JlZGVudGlhbHM+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGFzc3VtZVJvbGVDcmVkZW50aWFscyA9IGF3YWl0IHRoaXMucGVyZm9ybVJlcXVlc3QoKVxyXG4gICAgICB0aGlzLl9jcmVkZW50aWFscyA9IHRoaXMucGFyc2VDcmVkZW50aWFscyhhc3N1bWVSb2xlQ3JlZGVudGlhbHMpXHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0IENyZWRlbnRpYWxzOiAke2Vycn1gLCB7IGNhdXNlOiBlcnIgfSlcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5fY3JlZGVudGlhbHNcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENyZWRlbnRpYWxzKCk6IFByb21pc2U8Q3JlZGVudGlhbHM+IHtcclxuICAgIGlmICh0aGlzLl9jcmVkZW50aWFscyAmJiAhdGhpcy5pc0Fib3V0VG9FeHBpcmUoKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY3JlZGVudGlhbHNcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9jcmVkZW50aWFscyA9IGF3YWl0IHRoaXMucmVmcmVzaENyZWRlbnRpYWxzKClcclxuICAgIHJldHVybiB0aGlzLl9jcmVkZW50aWFsc1xyXG4gIH1cclxuXHJcbiAgaXNBYm91dFRvRXhwaXJlKCkge1xyXG4gICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUodGhpcy5hY2Nlc3NFeHBpcmVzQXQpXHJcbiAgICBjb25zdCBwcm92aXNpb25hbEV4cGlyeSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxMDAwICogMTApIC8vIGNoZWNrIGJlZm9yZSAxMCBzZWNvbmRzLlxyXG4gICAgcmV0dXJuIHByb3Zpc2lvbmFsRXhwaXJ5ID4gZXhwaXJlc0F0XHJcbiAgfVxyXG59XHJcblxyXG4vLyBkZXByZWNhdGVkIGRlZmF1bHQgZXhwb3J0LCBwbGVhc2UgdXNlIG5hbWVkIGV4cG9ydHMuXHJcbi8vIGtlZXAgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkuXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tZGVmYXVsdC1leHBvcnRcclxuZXhwb3J0IGRlZmF1bHQgQXNzdW1lUm9sZVByb3ZpZGVyXHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxJQUFBQSxJQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxLQUFBLEdBQUFGLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxJQUFBLEdBQUFGLE9BQUE7QUFFQSxJQUFBRyxtQkFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksWUFBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssT0FBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0sUUFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sU0FBQSxHQUFBUCxPQUFBO0FBRUEsSUFBQVEsUUFBQSxHQUFBUixPQUFBO0FBQWtELFNBQUFELHdCQUFBVSxDQUFBLEVBQUFDLENBQUEsNkJBQUFDLE9BQUEsTUFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFB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