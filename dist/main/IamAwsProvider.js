"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var fs = _interopRequireWildcard(require("fs/promises"), true);
var http = _interopRequireWildcard(require("http"), true);
var https = _interopRequireWildcard(require("https"), true);
var _url = require("url");
var _CredentialProvider = require("./CredentialProvider.js");
var _Credentials = require("./Credentials.js");
var _helper = require("./internal/helper.js");
var _request = require("./internal/request.js");
var _response = require("./internal/response.js");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
class IamAwsProvider extends _CredentialProvider.CredentialProvider {
  accessExpiresAt = '';
  constructor({
    customEndpoint = undefined,
    transportAgent = undefined
  }) {
    super({
      accessKey: '',
      secretKey: ''
    });
    this.customEndpoint = customEndpoint;
    this.transportAgent = transportAgent;

    /**
     * Internal Tracking variables
     */
    this._credentials = null;
  }
  async getCredentials() {
    if (!this._credentials || this.isAboutToExpire()) {
      this._credentials = await this.fetchCredentials();
    }
    return this._credentials;
  }
  async fetchCredentials() {
    try {
      // check for IRSA (https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html)
      const tokenFile = process.env.AWS_WEB_IDENTITY_TOKEN_FILE;
      if (tokenFile) {
        return await this.fetchCredentialsUsingTokenFile(tokenFile);
      }

      // try with IAM role for EC2 instances (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html)
      let tokenHeader = 'Authorization';
      let token = process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN;
      const relativeUri = process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI;
      const fullUri = process.env.AWS_CONTAINER_CREDENTIALS_FULL_URI;
      let url;
      if (relativeUri) {
        url = new _url.URL(relativeUri, 'http://169.254.170.2');
      } else if (fullUri) {
        url = new _url.URL(fullUri);
      } else {
        token = await this.fetchImdsToken();
        tokenHeader = 'X-aws-ec2-metadata-token';
        url = await this.getIamRoleNamedUrl(token);
      }
      return this.requestCredentials(url, tokenHeader, token);
    } catch (err) {
      throw new Error(`Failed to get Credentials: ${err}`, {
        cause: err
      });
    }
  }
  async fetchCredentialsUsingTokenFile(tokenFile) {
    const token = await fs.readFile(tokenFile, {
      encoding: 'utf8'
    });
    const region = process.env.AWS_REGION;
    const stsEndpoint = new _url.URL(region ? `https://sts.${region}.amazonaws.com` : 'https://sts.amazonaws.com');
    const hostValue = stsEndpoint.hostname;
    const portValue = stsEndpoint.port;
    const qryParams = new _url.URLSearchParams({
      Action: 'AssumeRoleWithWebIdentity',
      Version: '2011-06-15'
    });
    const roleArn = process.env.AWS_ROLE_ARN;
    if (roleArn) {
      qryParams.set('RoleArn', roleArn);
      const roleSessionName = process.env.AWS_ROLE_SESSION_NAME;
      qryParams.set('RoleSessionName', roleSessionName ? roleSessionName : Date.now().toString());
    }
    qryParams.set('WebIdentityToken', token);
    qryParams.sort();
    const requestOptions = {
      hostname: hostValue,
      port: portValue,
      path: `${stsEndpoint.pathname}?${qryParams.toString()}`,
      protocol: stsEndpoint.protocol,
      method: 'POST',
      headers: {},
      agent: this.transportAgent
    };
    const transport = stsEndpoint.protocol === 'http:' ? http : https;
    const res = await (0, _request.request)(transport, requestOptions, null);
    const body = await (0, _response.readAsString)(res);
    const assumeRoleResponse = (0, _helper.parseXml)(body);
    const creds = assumeRoleResponse.AssumeRoleWithWebIdentityResponse.AssumeRoleWithWebIdentityResult.Credentials;
    this.accessExpiresAt = creds.Expiration;
    return new _Credentials.Credentials({
      accessKey: creds.AccessKeyId,
      secretKey: creds.SecretAccessKey,
      sessionToken: creds.SessionToken
    });
  }
  async fetchImdsToken() {
    const endpoint = this.customEndpoint ? this.customEndpoint : 'http://169.254.169.254';
    const url = new _url.URL('/latest/api/token', endpoint);
    const requestOptions = {
      hostname: url.hostname,
      port: url.port,
      path: `${url.pathname}${url.search}`,
      protocol: url.protocol,
      method: 'PUT',
      headers: {
        'X-aws-ec2-metadata-token-ttl-seconds': '21600'
      },
      agent: this.transportAgent
    };
    const transport = url.protocol === 'http:' ? http : https;
    const res = await (0, _request.request)(transport, requestOptions, null);
    return await (0, _response.readAsString)(res);
  }
  async getIamRoleNamedUrl(token) {
    const endpoint = this.customEndpoint ? this.customEndpoint : 'http://169.254.169.254';
    const url = new _url.URL('latest/meta-data/iam/security-credentials/', endpoint);
    const roleName = await this.getIamRoleName(url, token);
    return new _url.URL(`${url.pathname}/${encodeURIComponent(roleName)}`, url.origin);
  }
  async getIamRoleName(url, token) {
    const requestOptions = {
      hostname: url.hostname,
      port: url.port,
      path: `${url.pathname}${url.search}`,
      protocol: url.protocol,
      method: 'GET',
      headers: {
        'X-aws-ec2-metadata-token': token
      },
      agent: this.transportAgent
    };
    const transport = url.protocol === 'http:' ? http : https;
    const res = await (0, _request.request)(transport, requestOptions, null);
    const body = await (0, _response.readAsString)(res);
    const roleNames = body.split(/\r\n|[\n\r\u2028\u2029]/);
    if (roleNames.length === 0) {
      throw new Error(`No IAM roles attached to EC2 service ${url}`);
    }
    return roleNames[0];
  }
  async requestCredentials(url, tokenHeader, token) {
    const headers = {};
    if (token) {
      headers[tokenHeader] = token;
    }
    const requestOptions = {
      hostname: url.hostname,
      port: url.port,
      path: `${url.pathname}${url.search}`,
      protocol: url.protocol,
      method: 'GET',
      headers: headers,
      agent: this.transportAgent
    };
    const transport = url.protocol === 'http:' ? http : https;
    const res = await (0, _request.request)(transport, requestOptions, null);
    const body = await (0, _response.readAsString)(res);
    const ecsCredentials = JSON.parse(body);
    if (!ecsCredentials.Code || ecsCredentials.Code != 'Success') {
      throw new Error(`${url} failed with code ${ecsCredentials.Code} and message ${ecsCredentials.Message}`);
    }
    this.accessExpiresAt = ecsCredentials.Expiration;
    return new _Credentials.Credentials({
      accessKey: ecsCredentials.AccessKeyID,
      secretKey: ecsCredentials.SecretAccessKey,
      sessionToken: ecsCredentials.Token
    });
  }
  isAboutToExpire() {
    const expiresAt = new Date(this.accessExpiresAt);
    const provisionalExpiry = new Date(Date.now() + 1000 * 10); // 10 seconds leeway
    return provisionalExpiry > expiresAt;
  }
}

// deprecated default export, please use named exports.
// keep for backward compatibility.
// eslint-disable-next-line import/no-default-export
exports.IamAwsProvider = IamAwsProvider;
var _default = exports.default = IamAwsProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsImh0dHAiLCJodHRwcyIsIl91cmwiLCJfQ3JlZGVudGlhbFByb3ZpZGVyIiwiX0NyZWRlbnRpYWxzIiwiX2hlbHBlciIsIl9yZXF1ZXN0IiwiX3Jlc3BvbnNlIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiSWFtQXdzUHJvdmlkZXIiLCJDcmVkZW50aWFsUHJvdmlkZXIiLCJhY2Nlc3NFeHBpcmVzQXQiLCJjb25zdHJ1Y3RvciIsImN1c3RvbUVuZHBvaW50IiwidW5kZWZpbmVkIiwidHJhbnNwb3J0QWdlbnQiLCJhY2Nlc3NLZXkiLCJzZWNyZXRLZXkiLCJfY3JlZGVudGlhbHMiLCJnZXRDcmVkZW50aWFscyIsImlzQWJvdXRUb0V4cGlyZSIsImZldGNoQ3JlZGVudGlhbHMiLCJ0b2tlbkZpbGUiLCJwcm9jZXNzIiwiZW52IiwiQVdTX1dFQl9JREVOVElUWV9UT0tFTl9GSUxFIiwiZmV0Y2hDcmVkZW50aWFsc1VzaW5nVG9rZW5GaWxlIiwidG9rZW5IZWFkZXIiLCJ0b2tlbiIsIkFXU19DT05UQUlORVJfQVVUSE9SSVpBVElPTl9UT0tFTiIsInJlbGF0aXZlVXJpIiwiQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19SRUxBVElWRV9VUkkiLCJmdWxsVXJpIiwiQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19GVUxMX1VSSSIsInVybCIsIlVSTCIsImZldGNoSW1kc1Rva2VuIiwiZ2V0SWFtUm9sZU5hbWVkVXJsIiwicmVxdWVzdENyZWRlbnRpYWxzIiwiZXJyIiwiRXJyb3IiLCJjYXVzZSIsInJlYWRGaWxlIiwiZW5jb2RpbmciLCJyZWdpb24iLCJBV1NfUkVHSU9OIiwic3RzRW5kcG9pbnQiLCJob3N0VmFsdWUiLCJob3N0bmFtZSIsInBvcnRWYWx1ZSIsInBvcnQiLCJxcnlQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJBY3Rpb24iLCJWZXJzaW9uIiwicm9sZUFybiIsIkFXU19ST0xFX0FSTiIsInJvbGVTZXNzaW9uTmFtZSIsIkFXU19ST0xFX1NFU1NJT05fTkFNRSIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsInNvcnQiLCJyZXF1ZXN0T3B0aW9ucyIsInBhdGgiLCJwYXRobmFtZSIsInByb3RvY29sIiwibWV0aG9kIiwiaGVhZGVycyIsImFnZW50IiwidHJhbnNwb3J0IiwicmVzIiwicmVxdWVzdCIsImJvZHkiLCJyZWFkQXNTdHJpbmciLCJhc3N1bWVSb2xlUmVzcG9uc2UiLCJwYXJzZVhtbCIsImNyZWRzIiwiQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3BvbnNlIiwiQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3VsdCIsIkNyZWRlbnRpYWxzIiwiRXhwaXJhdGlvbiIsIkFjY2Vzc0tleUlkIiwiU2VjcmV0QWNjZXNzS2V5Iiwic2Vzc2lvblRva2VuIiwiU2Vzc2lvblRva2VuIiwiZW5kcG9pbnQiLCJzZWFyY2giLCJyb2xlTmFtZSIsImdldElhbVJvbGVOYW1lIiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwib3JpZ2luIiwicm9sZU5hbWVzIiwic3BsaXQiLCJsZW5ndGgiLCJlY3NDcmVkZW50aWFscyIsIkpTT04iLCJwYXJzZSIsIkNvZGUiLCJNZXNzYWdlIiwiQWNjZXNzS2V5SUQiLCJUb2tlbiIsImV4cGlyZXNBdCIsInByb3Zpc2lvbmFsRXhwaXJ5IiwiZXhwb3J0cyIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiSWFtQXdzUHJvdmlkZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnbm9kZTpmcy9wcm9taXNlcydcclxuaW1wb3J0ICogYXMgaHR0cCBmcm9tICdub2RlOmh0dHAnXHJcbmltcG9ydCAqIGFzIGh0dHBzIGZyb20gJ25vZGU6aHR0cHMnXHJcbmltcG9ydCB7IFVSTCwgVVJMU2VhcmNoUGFyYW1zIH0gZnJvbSAnbm9kZTp1cmwnXHJcblxyXG5pbXBvcnQgeyBDcmVkZW50aWFsUHJvdmlkZXIgfSBmcm9tICcuL0NyZWRlbnRpYWxQcm92aWRlci50cydcclxuaW1wb3J0IHsgQ3JlZGVudGlhbHMgfSBmcm9tICcuL0NyZWRlbnRpYWxzLnRzJ1xyXG5pbXBvcnQgeyBwYXJzZVhtbCB9IGZyb20gJy4vaW50ZXJuYWwvaGVscGVyLnRzJ1xyXG5pbXBvcnQgeyByZXF1ZXN0IH0gZnJvbSAnLi9pbnRlcm5hbC9yZXF1ZXN0LnRzJ1xyXG5pbXBvcnQgeyByZWFkQXNTdHJpbmcgfSBmcm9tICcuL2ludGVybmFsL3Jlc3BvbnNlLnRzJ1xyXG5cclxuaW50ZXJmYWNlIEFzc3VtZVJvbGVSZXNwb25zZSB7XHJcbiAgQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3BvbnNlOiB7XHJcbiAgICBBc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5UmVzdWx0OiB7XHJcbiAgICAgIENyZWRlbnRpYWxzOiB7XHJcbiAgICAgICAgQWNjZXNzS2V5SWQ6IHN0cmluZ1xyXG4gICAgICAgIFNlY3JldEFjY2Vzc0tleTogc3RyaW5nXHJcbiAgICAgICAgU2Vzc2lvblRva2VuOiBzdHJpbmdcclxuICAgICAgICBFeHBpcmF0aW9uOiBzdHJpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIEVjc0NyZWRlbnRpYWxzIHtcclxuICBBY2Nlc3NLZXlJRDogc3RyaW5nXHJcbiAgU2VjcmV0QWNjZXNzS2V5OiBzdHJpbmdcclxuICBUb2tlbjogc3RyaW5nXHJcbiAgRXhwaXJhdGlvbjogc3RyaW5nXHJcbiAgQ29kZTogc3RyaW5nXHJcbiAgTWVzc2FnZTogc3RyaW5nXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSWFtQXdzUHJvdmlkZXJPcHRpb25zIHtcclxuICBjdXN0b21FbmRwb2ludD86IHN0cmluZ1xyXG4gIHRyYW5zcG9ydEFnZW50PzogaHR0cC5BZ2VudFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSWFtQXdzUHJvdmlkZXIgZXh0ZW5kcyBDcmVkZW50aWFsUHJvdmlkZXIge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY3VzdG9tRW5kcG9pbnQ/OiBzdHJpbmdcclxuXHJcbiAgcHJpdmF0ZSBfY3JlZGVudGlhbHM6IENyZWRlbnRpYWxzIHwgbnVsbFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhbnNwb3J0QWdlbnQ/OiBodHRwLkFnZW50XHJcbiAgcHJpdmF0ZSBhY2Nlc3NFeHBpcmVzQXQgPSAnJ1xyXG5cclxuICBjb25zdHJ1Y3Rvcih7IGN1c3RvbUVuZHBvaW50ID0gdW5kZWZpbmVkLCB0cmFuc3BvcnRBZ2VudCA9IHVuZGVmaW5lZCB9OiBJYW1Bd3NQcm92aWRlck9wdGlvbnMpIHtcclxuICAgIHN1cGVyKHsgYWNjZXNzS2V5OiAnJywgc2VjcmV0S2V5OiAnJyB9KVxyXG5cclxuICAgIHRoaXMuY3VzdG9tRW5kcG9pbnQgPSBjdXN0b21FbmRwb2ludFxyXG4gICAgdGhpcy50cmFuc3BvcnRBZ2VudCA9IHRyYW5zcG9ydEFnZW50XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnRlcm5hbCBUcmFja2luZyB2YXJpYWJsZXNcclxuICAgICAqL1xyXG4gICAgdGhpcy5fY3JlZGVudGlhbHMgPSBudWxsXHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRDcmVkZW50aWFscygpOiBQcm9taXNlPENyZWRlbnRpYWxzPiB7XHJcbiAgICBpZiAoIXRoaXMuX2NyZWRlbnRpYWxzIHx8IHRoaXMuaXNBYm91dFRvRXhwaXJlKCkpIHtcclxuICAgICAgdGhpcy5fY3JlZGVudGlhbHMgPSBhd2FpdCB0aGlzLmZldGNoQ3JlZGVudGlhbHMoKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX2NyZWRlbnRpYWxzXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGZldGNoQ3JlZGVudGlhbHMoKTogUHJvbWlzZTxDcmVkZW50aWFscz4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gY2hlY2sgZm9yIElSU0EgKGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9la3MvbGF0ZXN0L3VzZXJndWlkZS9pYW0tcm9sZXMtZm9yLXNlcnZpY2UtYWNjb3VudHMuaHRtbClcclxuICAgICAgY29uc3QgdG9rZW5GaWxlID0gcHJvY2Vzcy5lbnYuQVdTX1dFQl9JREVOVElUWV9UT0tFTl9GSUxFXHJcbiAgICAgIGlmICh0b2tlbkZpbGUpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5mZXRjaENyZWRlbnRpYWxzVXNpbmdUb2tlbkZpbGUodG9rZW5GaWxlKVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB0cnkgd2l0aCBJQU0gcm9sZSBmb3IgRUMyIGluc3RhbmNlcyAoaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FXU0VDMi9sYXRlc3QvVXNlckd1aWRlL2lhbS1yb2xlcy1mb3ItYW1hem9uLWVjMi5odG1sKVxyXG4gICAgICBsZXQgdG9rZW5IZWFkZXIgPSAnQXV0aG9yaXphdGlvbidcclxuICAgICAgbGV0IHRva2VuID0gcHJvY2Vzcy5lbnYuQVdTX0NPTlRBSU5FUl9BVVRIT1JJWkFUSU9OX1RPS0VOXHJcbiAgICAgIGNvbnN0IHJlbGF0aXZlVXJpID0gcHJvY2Vzcy5lbnYuQVdTX0NPTlRBSU5FUl9DUkVERU5USUFMU19SRUxBVElWRV9VUklcclxuICAgICAgY29uc3QgZnVsbFVyaSA9IHByb2Nlc3MuZW52LkFXU19DT05UQUlORVJfQ1JFREVOVElBTFNfRlVMTF9VUklcclxuICAgICAgbGV0IHVybDogVVJMXHJcbiAgICAgIGlmIChyZWxhdGl2ZVVyaSkge1xyXG4gICAgICAgIHVybCA9IG5ldyBVUkwocmVsYXRpdmVVcmksICdodHRwOi8vMTY5LjI1NC4xNzAuMicpXHJcbiAgICAgIH0gZWxzZSBpZiAoZnVsbFVyaSkge1xyXG4gICAgICAgIHVybCA9IG5ldyBVUkwoZnVsbFVyaSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0b2tlbiA9IGF3YWl0IHRoaXMuZmV0Y2hJbWRzVG9rZW4oKVxyXG4gICAgICAgIHRva2VuSGVhZGVyID0gJ1gtYXdzLWVjMi1tZXRhZGF0YS10b2tlbidcclxuICAgICAgICB1cmwgPSBhd2FpdCB0aGlzLmdldElhbVJvbGVOYW1lZFVybCh0b2tlbilcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdENyZWRlbnRpYWxzKHVybCwgdG9rZW5IZWFkZXIsIHRva2VuKVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCBDcmVkZW50aWFsczogJHtlcnJ9YCwgeyBjYXVzZTogZXJyIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGZldGNoQ3JlZGVudGlhbHNVc2luZ1Rva2VuRmlsZSh0b2tlbkZpbGU6IHN0cmluZyk6IFByb21pc2U8Q3JlZGVudGlhbHM+IHtcclxuICAgIGNvbnN0IHRva2VuID0gYXdhaXQgZnMucmVhZEZpbGUodG9rZW5GaWxlLCB7IGVuY29kaW5nOiAndXRmOCcgfSlcclxuICAgIGNvbnN0IHJlZ2lvbiA9IHByb2Nlc3MuZW52LkFXU19SRUdJT05cclxuICAgIGNvbnN0IHN0c0VuZHBvaW50ID0gbmV3IFVSTChyZWdpb24gPyBgaHR0cHM6Ly9zdHMuJHtyZWdpb259LmFtYXpvbmF3cy5jb21gIDogJ2h0dHBzOi8vc3RzLmFtYXpvbmF3cy5jb20nKVxyXG5cclxuICAgIGNvbnN0IGhvc3RWYWx1ZSA9IHN0c0VuZHBvaW50Lmhvc3RuYW1lXHJcbiAgICBjb25zdCBwb3J0VmFsdWUgPSBzdHNFbmRwb2ludC5wb3J0XHJcbiAgICBjb25zdCBxcnlQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcclxuICAgICAgQWN0aW9uOiAnQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eScsXHJcbiAgICAgIFZlcnNpb246ICcyMDExLTA2LTE1JyxcclxuICAgIH0pXHJcblxyXG4gICAgY29uc3Qgcm9sZUFybiA9IHByb2Nlc3MuZW52LkFXU19ST0xFX0FSTlxyXG4gICAgaWYgKHJvbGVBcm4pIHtcclxuICAgICAgcXJ5UGFyYW1zLnNldCgnUm9sZUFybicsIHJvbGVBcm4pXHJcbiAgICAgIGNvbnN0IHJvbGVTZXNzaW9uTmFtZSA9IHByb2Nlc3MuZW52LkFXU19ST0xFX1NFU1NJT05fTkFNRVxyXG4gICAgICBxcnlQYXJhbXMuc2V0KCdSb2xlU2Vzc2lvbk5hbWUnLCByb2xlU2Vzc2lvbk5hbWUgPyByb2xlU2Vzc2lvbk5hbWUgOiBEYXRlLm5vdygpLnRvU3RyaW5nKCkpXHJcbiAgICB9XHJcblxyXG4gICAgcXJ5UGFyYW1zLnNldCgnV2ViSWRlbnRpdHlUb2tlbicsIHRva2VuKVxyXG4gICAgcXJ5UGFyYW1zLnNvcnQoKVxyXG5cclxuICAgIGNvbnN0IHJlcXVlc3RPcHRpb25zID0ge1xyXG4gICAgICBob3N0bmFtZTogaG9zdFZhbHVlLFxyXG4gICAgICBwb3J0OiBwb3J0VmFsdWUsXHJcbiAgICAgIHBhdGg6IGAke3N0c0VuZHBvaW50LnBhdGhuYW1lfT8ke3FyeVBhcmFtcy50b1N0cmluZygpfWAsXHJcbiAgICAgIHByb3RvY29sOiBzdHNFbmRwb2ludC5wcm90b2NvbCxcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHt9LFxyXG4gICAgICBhZ2VudDogdGhpcy50cmFuc3BvcnRBZ2VudCxcclxuICAgIH0gc2F0aXNmaWVzIGh0dHAuUmVxdWVzdE9wdGlvbnNcclxuXHJcbiAgICBjb25zdCB0cmFuc3BvcnQgPSBzdHNFbmRwb2ludC5wcm90b2NvbCA9PT0gJ2h0dHA6JyA/IGh0dHAgOiBodHRwc1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh0cmFuc3BvcnQsIHJlcXVlc3RPcHRpb25zLCBudWxsKVxyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlYWRBc1N0cmluZyhyZXMpXHJcblxyXG4gICAgY29uc3QgYXNzdW1lUm9sZVJlc3BvbnNlOiBBc3N1bWVSb2xlUmVzcG9uc2UgPSBwYXJzZVhtbChib2R5KVxyXG4gICAgY29uc3QgY3JlZHMgPSBhc3N1bWVSb2xlUmVzcG9uc2UuQXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eVJlc3BvbnNlLkFzc3VtZVJvbGVXaXRoV2ViSWRlbnRpdHlSZXN1bHQuQ3JlZGVudGlhbHNcclxuICAgIHRoaXMuYWNjZXNzRXhwaXJlc0F0ID0gY3JlZHMuRXhwaXJhdGlvblxyXG4gICAgcmV0dXJuIG5ldyBDcmVkZW50aWFscyh7XHJcbiAgICAgIGFjY2Vzc0tleTogY3JlZHMuQWNjZXNzS2V5SWQsXHJcbiAgICAgIHNlY3JldEtleTogY3JlZHMuU2VjcmV0QWNjZXNzS2V5LFxyXG4gICAgICBzZXNzaW9uVG9rZW46IGNyZWRzLlNlc3Npb25Ub2tlbixcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGZldGNoSW1kc1Rva2VuKCkge1xyXG4gICAgY29uc3QgZW5kcG9pbnQgPSB0aGlzLmN1c3RvbUVuZHBvaW50ID8gdGhpcy5jdXN0b21FbmRwb2ludCA6ICdodHRwOi8vMTY5LjI1NC4xNjkuMjU0J1xyXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTCgnL2xhdGVzdC9hcGkvdG9rZW4nLCBlbmRwb2ludClcclxuXHJcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgaG9zdG5hbWU6IHVybC5ob3N0bmFtZSxcclxuICAgICAgcG9ydDogdXJsLnBvcnQsXHJcbiAgICAgIHBhdGg6IGAke3VybC5wYXRobmFtZX0ke3VybC5zZWFyY2h9YCxcclxuICAgICAgcHJvdG9jb2w6IHVybC5wcm90b2NvbCxcclxuICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdYLWF3cy1lYzItbWV0YWRhdGEtdG9rZW4tdHRsLXNlY29uZHMnOiAnMjE2MDAnLFxyXG4gICAgICB9LFxyXG4gICAgICBhZ2VudDogdGhpcy50cmFuc3BvcnRBZ2VudCxcclxuICAgIH0gc2F0aXNmaWVzIGh0dHAuUmVxdWVzdE9wdGlvbnNcclxuXHJcbiAgICBjb25zdCB0cmFuc3BvcnQgPSB1cmwucHJvdG9jb2wgPT09ICdodHRwOicgPyBodHRwIDogaHR0cHNcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QodHJhbnNwb3J0LCByZXF1ZXN0T3B0aW9ucywgbnVsbClcclxuICAgIHJldHVybiBhd2FpdCByZWFkQXNTdHJpbmcocmVzKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRJYW1Sb2xlTmFtZWRVcmwodG9rZW46IHN0cmluZykge1xyXG4gICAgY29uc3QgZW5kcG9pbnQgPSB0aGlzLmN1c3RvbUVuZHBvaW50ID8gdGhpcy5jdXN0b21FbmRwb2ludCA6ICdodHRwOi8vMTY5LjI1NC4xNjkuMjU0J1xyXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTCgnbGF0ZXN0L21ldGEtZGF0YS9pYW0vc2VjdXJpdHktY3JlZGVudGlhbHMvJywgZW5kcG9pbnQpXHJcblxyXG4gICAgY29uc3Qgcm9sZU5hbWUgPSBhd2FpdCB0aGlzLmdldElhbVJvbGVOYW1lKHVybCwgdG9rZW4pXHJcbiAgICByZXR1cm4gbmV3IFVSTChgJHt1cmwucGF0aG5hbWV9LyR7ZW5jb2RlVVJJQ29tcG9uZW50KHJvbGVOYW1lKX1gLCB1cmwub3JpZ2luKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRJYW1Sb2xlTmFtZSh1cmw6IFVSTCwgdG9rZW46IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgaG9zdG5hbWU6IHVybC5ob3N0bmFtZSxcclxuICAgICAgcG9ydDogdXJsLnBvcnQsXHJcbiAgICAgIHBhdGg6IGAke3VybC5wYXRobmFtZX0ke3VybC5zZWFyY2h9YCxcclxuICAgICAgcHJvdG9jb2w6IHVybC5wcm90b2NvbCxcclxuICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdYLWF3cy1lYzItbWV0YWRhdGEtdG9rZW4nOiB0b2tlbixcclxuICAgICAgfSxcclxuICAgICAgYWdlbnQ6IHRoaXMudHJhbnNwb3J0QWdlbnQsXHJcbiAgICB9IHNhdGlzZmllcyBodHRwLlJlcXVlc3RPcHRpb25zXHJcblxyXG4gICAgY29uc3QgdHJhbnNwb3J0ID0gdXJsLnByb3RvY29sID09PSAnaHR0cDonID8gaHR0cCA6IGh0dHBzXHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KHRyYW5zcG9ydCwgcmVxdWVzdE9wdGlvbnMsIG51bGwpXHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVhZEFzU3RyaW5nKHJlcylcclxuICAgIGNvbnN0IHJvbGVOYW1lcyA9IGJvZHkuc3BsaXQoL1xcclxcbnxbXFxuXFxyXFx1MjAyOFxcdTIwMjldLylcclxuICAgIGlmIChyb2xlTmFtZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gSUFNIHJvbGVzIGF0dGFjaGVkIHRvIEVDMiBzZXJ2aWNlICR7dXJsfWApXHJcbiAgICB9XHJcbiAgICByZXR1cm4gcm9sZU5hbWVzWzBdIGFzIHN0cmluZ1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyByZXF1ZXN0Q3JlZGVudGlhbHModXJsOiBVUkwsIHRva2VuSGVhZGVyOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBQcm9taXNlPENyZWRlbnRpYWxzPiB7XHJcbiAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge31cclxuICAgIGlmICh0b2tlbikge1xyXG4gICAgICBoZWFkZXJzW3Rva2VuSGVhZGVyXSA9IHRva2VuXHJcbiAgICB9XHJcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgaG9zdG5hbWU6IHVybC5ob3N0bmFtZSxcclxuICAgICAgcG9ydDogdXJsLnBvcnQsXHJcbiAgICAgIHBhdGg6IGAke3VybC5wYXRobmFtZX0ke3VybC5zZWFyY2h9YCxcclxuICAgICAgcHJvdG9jb2w6IHVybC5wcm90b2NvbCxcclxuICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgaGVhZGVyczogaGVhZGVycyxcclxuICAgICAgYWdlbnQ6IHRoaXMudHJhbnNwb3J0QWdlbnQsXHJcbiAgICB9IHNhdGlzZmllcyBodHRwLlJlcXVlc3RPcHRpb25zXHJcblxyXG4gICAgY29uc3QgdHJhbnNwb3J0ID0gdXJsLnByb3RvY29sID09PSAnaHR0cDonID8gaHR0cCA6IGh0dHBzXHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KHRyYW5zcG9ydCwgcmVxdWVzdE9wdGlvbnMsIG51bGwpXHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVhZEFzU3RyaW5nKHJlcylcclxuICAgIGNvbnN0IGVjc0NyZWRlbnRpYWxzID0gSlNPTi5wYXJzZShib2R5KSBhcyBFY3NDcmVkZW50aWFsc1xyXG4gICAgaWYgKCFlY3NDcmVkZW50aWFscy5Db2RlIHx8IGVjc0NyZWRlbnRpYWxzLkNvZGUgIT0gJ1N1Y2Nlc3MnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHt1cmx9IGZhaWxlZCB3aXRoIGNvZGUgJHtlY3NDcmVkZW50aWFscy5Db2RlfSBhbmQgbWVzc2FnZSAke2Vjc0NyZWRlbnRpYWxzLk1lc3NhZ2V9YClcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFjY2Vzc0V4cGlyZXNBdCA9IGVjc0NyZWRlbnRpYWxzLkV4cGlyYXRpb25cclxuICAgIHJldHVybiBuZXcgQ3JlZGVudGlhbHMoe1xyXG4gICAgICBhY2Nlc3NLZXk6IGVjc0NyZWRlbnRpYWxzLkFjY2Vzc0tleUlELFxyXG4gICAgICBzZWNyZXRLZXk6IGVjc0NyZWRlbnRpYWxzLlNlY3JldEFjY2Vzc0tleSxcclxuICAgICAgc2Vzc2lvblRva2VuOiBlY3NDcmVkZW50aWFscy5Ub2tlbixcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzQWJvdXRUb0V4cGlyZSgpIHtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKHRoaXMuYWNjZXNzRXhwaXJlc0F0KVxyXG4gICAgY29uc3QgcHJvdmlzaW9uYWxFeHBpcnkgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTAwMCAqIDEwKSAvLyAxMCBzZWNvbmRzIGxlZXdheVxyXG4gICAgcmV0dXJuIHByb3Zpc2lvbmFsRXhwaXJ5ID4gZXhwaXJlc0F0XHJcbiAgfVxyXG59XHJcblxyXG4vLyBkZXByZWNhdGVkIGRlZmF1bHQgZXhwb3J0LCBwbGVhc2UgdXNlIG5hbWVkIGV4cG9ydHMuXHJcbi8vIGtlZXAgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkuXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tZGVmYXVsdC1leHBvcnRcclxuZXhwb3J0IGRlZmF1bHQgSWFtQXdzUHJvdmlkZXJcclxuIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQUFBLEVBQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLElBQUEsR0FBQUYsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLEtBQUEsR0FBQUgsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLElBQUEsR0FBQUgsT0FBQTtBQUVBLElBQUFJLG1CQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxZQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxPQUFBLEdBQUFOLE9BQUE7QUFDQSxJQUFBTyxRQUFBLEdBQUFQLE9BQUE7QUFDQSxJQUFBUSxTQUFBLEdBQUFSLE9BQUE7QUFBcUQsU0FBQUQsd0JBQUFVLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFaLHVCQUFBLFlBQUFBLENBQUFVLENBQUEsRUFBQUMsQ0FBQSxTQUFBQSxDQUFBLElBQUFELENBQUEsSUFBQUEsQ0FBQSxDQUFBSyxVQUFBLFNBQUFMLENBQUEsTUFBQU0sQ0FBQSxFQUFBQyxDQUFBLEVBQUFDLENBQUEsS0FBQUMsU0FBQSxRQUFBQyxPQUFBLEVBQUFWLENBQUEsaUJBQUFBLENBQUEsdUJBQUFBLENBQUEseUJBQUFBLENBQUEsU0FBQVEsQ0FBQSxNQUFBRixDQUFBLEdBQUFMLENBQUEsR0FBQUcsQ0FBQSxHQUFBRCxDQUFBLFFBQUFHLENBQUEsQ0FBQUssR0FBQSxDQUFBWCxDQUFBLFVBQUFNLENBQUEsQ0FBQU0sR0FBQSxDQUFBWixDQUFBLEdBQUFNLENBQUEsQ0FBQU8sR0FBQSxDQUFBYixDQUFBLEVBQUFRLENBQUEsZ0JBQUFQLENBQUEsSUFBQUQsQ0FBQSxnQkFBQUMsQ0FBQSxPQUFBYSxjQUFBLENBQUFDLElBQUEsQ0FBQWYsQ0FBQSxFQUFBQyxDQUFBLE9BQUFNLENBQUEsSUFBQUQsQ0FBQSxHQUFBVSxNQUFBLENBQUFDLGNBQUEsS0FBQUQsTUFBQSxDQUFBRSx3QkFBQSxDQUFBbEIsQ0FBQSxFQUFBQyxDQUFBLE9BQUFNLENBQUEsQ0FBQUssR0FBQSxJQUFBTCxDQUFBLENBQUFNLEdBQUEsSUFBQVAsQ0FBQSxDQUFBRSxDQUFBLEVBQUFQLENBQUEsRUFBQU0sQ0FBQSxJQUFBQyxDQUFBLENBQUFQLENBQUEsSUFBQUQsQ0FBQSxDQUFBQyxDQUFBLFdBQUFPLENBQUEsS0FBQVIsQ0FBQSxFQUFBQyxDQUFBO0FBNkI5QyxNQUFNa0IsY0FBYyxTQUFTQyxzQ0FBa0IsQ0FBQztFQUs3Q0MsZUFBZSxHQUFHLEVBQUU7RUFFNUJDLFdBQVdBLENBQUM7SUFBRUMsY0FBYyxHQUFHQyxTQUFTO0lBQUVDLGNBQWMsR0FBR0Q7RUFBaUMsQ0FBQyxFQUFFO0lBQzdGLEtBQUssQ0FBQztNQUFFRSxTQUFTLEVBQUUsRUFBRTtNQUFFQyxTQUFTLEVBQUU7SUFBRyxDQUFDLENBQUM7SUFFdkMsSUFBSSxDQUFDSixjQUFjLEdBQUdBLGNBQWM7SUFDcEMsSUFBSSxDQUFDRSxjQUFjLEdBQUdBLGNBQWM7O0lBRXBDO0FBQ0o7QUFDQTtJQUNJLElBQUksQ0FBQ0csWUFBWSxHQUFHLElBQUk7RUFDMUI7RUFFQSxNQUFNQyxjQUFjQSxDQUFBLEVBQXlCO0lBQzNDLElBQUksQ0FBQyxJQUFJLENBQUNELFlBQVksSUFBSSxJQUFJLENBQUNFLGVBQWUsQ0FBQyxDQUFDLEVBQUU7TUFDaEQsSUFBSSxDQUFDRixZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUNHLGdCQUFnQixDQUFDLENBQUM7SUFDbkQ7SUFDQSxPQUFPLElBQUksQ0FBQ0gsWUFBWTtFQUMxQjtFQUVBLE1BQWNHLGdCQUFnQkEsQ0FBQSxFQUF5QjtJQUNyRCxJQUFJO01BQ0Y7TUFDQSxNQUFNQyxTQUFTLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQywyQkFBMkI7TUFDekQsSUFBSUgsU0FBUyxFQUFFO1FBQ2IsT0FBTyxNQUFNLElBQUksQ0FBQ0ksOEJBQThCLENBQUNKLFNBQVMsQ0FBQztNQUM3RDs7TUFFQTtNQUNBLElBQUlLLFdBQVcsR0FBRyxlQUFlO01BQ2pDLElBQUlDLEtBQUssR0FBR0wsT0FBTyxDQUFDQyxHQUFHLENBQUNLLGlDQUFpQztNQUN6RCxNQUFNQyxXQUFXLEdBQUdQLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDTyxzQ0FBc0M7TUFDdEUsTUFBTUMsT0FBTyxHQUFHVCxPQUFPLENBQUNDLEdBQUcsQ0FBQ1Msa0NBQWtDO01BQzlELElBQUlDLEdBQVE7TUFDWixJQUFJSixXQUFXLEVBQUU7UUFDZkksR0FBRyxHQUFHLElBQUlDLFFBQUcsQ0FBQ0wsV0FBVyxFQUFFLHNCQUFzQixDQUFDO01BQ3BELENBQUMsTUFBTSxJQUFJRSxPQUFPLEVBQUU7UUFDbEJFLEdBQUcsR0FBRyxJQUFJQyxRQUFHLENBQUNILE9BQU8sQ0FBQztNQUN4QixDQUFDLE1BQU07UUFDTEosS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDUSxjQUFjLENBQUMsQ0FBQztRQUNuQ1QsV0FBVyxHQUFHLDBCQUEwQjtRQUN4Q08sR0FBRyxHQUFHLE1BQU0sSUFBSSxDQUFDRyxrQkFBa0IsQ0FBQ1QsS0FBSyxDQUFDO01BQzVDO01BRUEsT0FBTyxJQUFJLENBQUNVLGtCQUFrQixDQUFDSixHQUFHLEVBQUVQLFdBQVcsRUFBRUMsS0FBSyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxPQUFPVyxHQUFHLEVBQUU7TUFDWixNQUFNLElBQUlDLEtBQUssQ0FBQyw4QkFBOEJELEdBQUcsRUFBRSxFQUFFO1FBQUVFLEtBQUssRUFBRUY7TUFBSSxDQUFDLENBQUM7SUFDdEU7RUFDRjtFQUVBLE1BQWNiLDhCQUE4QkEsQ0FBQ0osU0FBaUIsRUFBd0I7SUFDcEYsTUFBTU0sS0FBSyxHQUFHLE1BQU1qRCxFQUFFLENBQUMrRCxRQUFRLENBQUNwQixTQUFTLEVBQUU7TUFBRXFCLFFBQVEsRUFBRTtJQUFPLENBQUMsQ0FBQztJQUNoRSxNQUFNQyxNQUFNLEdBQUdyQixPQUFPLENBQUNDLEdBQUcsQ0FBQ3FCLFVBQVU7SUFDckMsTUFBTUMsV0FBVyxHQUFHLElBQUlYLFFBQUcsQ0FBQ1MsTUFBTSxHQUFHLGVBQWVBLE1BQU0sZ0JBQWdCLEdBQUcsMkJBQTJCLENBQUM7SUFFekcsTUFBTUcsU0FBUyxHQUFHRCxXQUFXLENBQUNFLFFBQVE7SUFDdEMsTUFBTUMsU0FBUyxHQUFHSCxXQUFXLENBQUNJLElBQUk7SUFDbEMsTUFBTUMsU0FBUyxHQUFHLElBQUlDLG9CQUFlLENBQUM7TUFDcENDLE1BQU0sRUFBRSwyQkFBMkI7TUFDbkNDLE9BQU8sRUFBRTtJQUNYLENBQUMsQ0FBQztJQUVGLE1BQU1DLE9BQU8sR0FBR2hDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDZ0MsWUFBWTtJQUN4QyxJQUFJRCxPQUFPLEVBQUU7TUFDWEosU0FBUyxDQUFDaEQsR0FBRyxDQUFDLFNBQVMsRUFBRW9ELE9BQU8sQ0FBQztNQUNqQyxNQUFNRSxlQUFlLEdBQUdsQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ2tDLHFCQUFxQjtNQUN6RFAsU0FBUyxDQUFDaEQsR0FBRyxDQUFDLGlCQUFpQixFQUFFc0QsZUFBZSxHQUFHQSxlQUFlLEdBQUdFLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsQ0FBQ0MsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUM3RjtJQUVBVixTQUFTLENBQUNoRCxHQUFHLENBQUMsa0JBQWtCLEVBQUV5QixLQUFLLENBQUM7SUFDeEN1QixTQUFTLENBQUNXLElBQUksQ0FBQyxDQUFDO0lBRWhCLE1BQU1DLGNBQWMsR0FBRztNQUNyQmYsUUFBUSxFQUFFRCxTQUFTO01BQ25CRyxJQUFJLEVBQUVELFNBQVM7TUFDZmUsSUFBSSxFQUFFLEdBQUdsQixXQUFXLENBQUNtQixRQUFRLElBQUlkLFNBQVMsQ0FBQ1UsUUFBUSxDQUFDLENBQUMsRUFBRTtNQUN2REssUUFBUSxFQUFFcEIsV0FBVyxDQUFDb0IsUUFBUTtNQUM5QkMsTUFBTSxFQUFFLE1BQU07TUFDZEMsT0FBTyxFQUFFLENBQUMsQ0FBQztNQUNYQyxLQUFLLEVBQUUsSUFBSSxDQUFDdEQ7SUFDZCxDQUErQjtJQUUvQixNQUFNdUQsU0FBUyxHQUFHeEIsV0FBVyxDQUFDb0IsUUFBUSxLQUFLLE9BQU8sR0FBR3BGLElBQUksR0FBR0MsS0FBSztJQUNqRSxNQUFNd0YsR0FBRyxHQUFHLE1BQU0sSUFBQUMsZ0JBQU8sRUFBQ0YsU0FBUyxFQUFFUCxjQUFjLEVBQUUsSUFBSSxDQUFDO0lBQzFELE1BQU1VLElBQUksR0FBRyxNQUFNLElBQUFDLHNCQUFZLEVBQUNILEdBQUcsQ0FBQztJQUVwQyxNQUFNSSxrQkFBc0MsR0FBRyxJQUFBQyxnQkFBUSxFQUFDSCxJQUFJLENBQUM7SUFDN0QsTUFBTUksS0FBSyxHQUFHRixrQkFBa0IsQ0FBQ0csaUNBQWlDLENBQUNDLCtCQUErQixDQUFDQyxXQUFXO0lBQzlHLElBQUksQ0FBQ3JFLGVBQWUsR0FBR2tFLEtBQUssQ0FBQ0ksVUFBVTtJQUN2QyxPQUFPLElBQUlELHdCQUFXLENBQUM7TUFDckJoRSxTQUFTLEVBQUU2RCxLQUFLLENBQUNLLFdBQVc7TUFDNUJqRSxTQUFTLEVBQUU0RCxLQUFLLENBQUNNLGVBQWU7TUFDaENDLFlBQVksRUFBRVAsS0FBSyxDQUFDUTtJQUN0QixDQUFDLENBQUM7RUFDSjtFQUVBLE1BQWNqRCxjQUFjQSxDQUFBLEVBQUc7SUFDN0IsTUFBTWtELFFBQVEsR0FBRyxJQUFJLENBQUN6RSxjQUFjLEdBQUcsSUFBSSxDQUFDQSxjQUFjLEdBQUcsd0JBQXdCO0lBQ3JGLE1BQU1xQixHQUFHLEdBQUcsSUFBSUMsUUFBRyxDQUFDLG1CQUFtQixFQUFFbUQsUUFBUSxDQUFDO0lBRWxELE1BQU12QixjQUFjLEdBQUc7TUFDckJmLFFBQVEsRUFBRWQsR0FBRyxDQUFDYyxRQUFRO01BQ3RCRSxJQUFJLEVBQUVoQixHQUFHLENBQUNnQixJQUFJO01BQ2RjLElBQUksRUFBRSxHQUFHOUIsR0FBRyxDQUFDK0IsUUFBUSxHQUFHL0IsR0FBRyxDQUFDcUQsTUFBTSxFQUFFO01BQ3BDckIsUUFBUSxFQUFFaEMsR0FBRyxDQUFDZ0MsUUFBUTtNQUN0QkMsTUFBTSxFQUFFLEtBQUs7TUFDYkMsT0FBTyxFQUFFO1FBQ1Asc0NBQXNDLEVBQUU7TUFDMUMsQ0FBQztNQUNEQyxLQUFLLEVBQUUsSUFBSSxDQUFDdEQ7SUFDZCxDQUErQjtJQUUvQixNQUFNdUQsU0FBUyxHQUFHcEMsR0FBRyxDQUFDZ0MsUUFBUSxLQUFLLE9BQU8sR0FBR3BGLElBQUksR0FBR0MsS0FBSztJQUN6RCxNQUFNd0YsR0FBRyxHQUFHLE1BQU0sSUFBQUMsZ0JBQU8sRUFBQ0YsU0FBUyxFQUFFUCxjQUFjLEVBQUUsSUFBSSxDQUFDO0lBQzFELE9BQU8sTUFBTSxJQUFBVyxzQkFBWSxFQUFDSCxHQUFHLENBQUM7RUFDaEM7RUFFQSxNQUFjbEMsa0JBQWtCQSxDQUFDVCxLQUFhLEVBQUU7SUFDOUMsTUFBTTBELFFBQVEsR0FBRyxJQUFJLENBQUN6RSxjQUFjLEdBQUcsSUFBSSxDQUFDQSxjQUFjLEdBQUcsd0JBQXdCO0lBQ3JGLE1BQU1xQixHQUFHLEdBQUcsSUFBSUMsUUFBRyxDQUFDLDRDQUE0QyxFQUFFbUQsUUFBUSxDQUFDO0lBRTNFLE1BQU1FLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQ0MsY0FBYyxDQUFDdkQsR0FBRyxFQUFFTixLQUFLLENBQUM7SUFDdEQsT0FBTyxJQUFJTyxRQUFHLENBQUMsR0FBR0QsR0FBRyxDQUFDK0IsUUFBUSxJQUFJeUIsa0JBQWtCLENBQUNGLFFBQVEsQ0FBQyxFQUFFLEVBQUV0RCxHQUFHLENBQUN5RCxNQUFNLENBQUM7RUFDL0U7RUFFQSxNQUFjRixjQUFjQSxDQUFDdkQsR0FBUSxFQUFFTixLQUFhLEVBQW1CO0lBQ3JFLE1BQU1tQyxjQUFjLEdBQUc7TUFDckJmLFFBQVEsRUFBRWQsR0FBRyxDQUFDYyxRQUFRO01BQ3RCRSxJQUFJLEVBQUVoQixHQUFHLENBQUNnQixJQUFJO01BQ2RjLElBQUksRUFBRSxHQUFHOUIsR0FBRyxDQUFDK0IsUUFBUSxHQUFHL0IsR0FBRyxDQUFDcUQsTUFBTSxFQUFFO01BQ3BDckIsUUFBUSxFQUFFaEMsR0FBRyxDQUFDZ0MsUUFBUTtNQUN0QkMsTUFBTSxFQUFFLEtBQUs7TUFDYkMsT0FBTyxFQUFFO1FBQ1AsMEJBQTBCLEVBQUV4QztNQUM5QixDQUFDO01BQ0R5QyxLQUFLLEVBQUUsSUFBSSxDQUFDdEQ7SUFDZCxDQUErQjtJQUUvQixNQUFNdUQsU0FBUyxHQUFHcEMsR0FBRyxDQUFDZ0MsUUFBUSxLQUFLLE9BQU8sR0FBR3BGLElBQUksR0FBR0MsS0FBSztJQUN6RCxNQUFNd0YsR0FBRyxHQUFHLE1BQU0sSUFBQUMsZ0JBQU8sRUFBQ0YsU0FBUyxFQUFFUCxjQUFjLEVBQUUsSUFBSSxDQUFDO0lBQzFELE1BQU1VLElBQUksR0FBRyxNQUFNLElBQUFDLHNCQUFZLEVBQUNILEdBQUcsQ0FBQztJQUNwQyxNQUFNcUIsU0FBUyxHQUFHbkIsSUFBSSxDQUFDb0IsS0FBSyxDQUFDLHlCQUF5QixDQUFDO0lBQ3ZELElBQUlELFNBQVMsQ0FBQ0UsTUFBTSxLQUFLLENBQUMsRUFBRTtNQUMxQixNQUFNLElBQUl0RCxLQUFLLENBQUMsd0NBQXdDTixHQUFHLEVBQUUsQ0FBQztJQUNoRTtJQUNBLE9BQU8wRCxTQUFTLENBQUMsQ0FBQyxDQUFDO0VBQ3JCO0VBRUEsTUFBY3RELGtCQUFrQkEsQ0FBQ0osR0FBUSxFQUFFUCxXQUFtQixFQUFFQyxLQUF5QixFQUF3QjtJQUMvRyxNQUFNd0MsT0FBK0IsR0FBRyxDQUFDLENBQUM7SUFDMUMsSUFBSXhDLEtBQUssRUFBRTtNQUNUd0MsT0FBTyxDQUFDekMsV0FBVyxDQUFDLEdBQUdDLEtBQUs7SUFDOUI7SUFDQSxNQUFNbUMsY0FBYyxHQUFHO01BQ3JCZixRQUFRLEVBQUVkLEdBQUcsQ0FBQ2MsUUFBUTtNQUN0QkUsSUFBSSxFQUFFaEIsR0FBRyxDQUFDZ0IsSUFBSTtNQUNkYyxJQUFJLEVBQUUsR0FBRzlCLEdBQUcsQ0FBQytCLFFBQVEsR0FBRy9CLEdBQUcsQ0FBQ3FELE1BQU0sRUFBRTtNQUNwQ3JCLFFBQVEsRUFBRWhDLEdBQUcsQ0FBQ2dDLFFBQVE7TUFDdEJDLE1BQU0sRUFBRSxLQUFLO01BQ2JDLE9BQU8sRUFBRUEsT0FBTztNQUNoQkMsS0FBSyxFQUFFLElBQUksQ0FBQ3REO0lBQ2QsQ0FBK0I7SUFFL0IsTUFBTXVELFNBQVMsR0FBR3BDLEdBQUcsQ0FBQ2dDLFFBQVEsS0FBSyxPQUFPLEdBQUdwRixJQUFJLEdBQUdDLEtBQUs7SUFDekQsTUFBTXdGLEdBQUcsR0FBRyxNQUFNLElBQUFDLGdCQUFPLEVBQUNGLFNBQVMsRUFBRVAsY0FBYyxFQUFFLElBQUksQ0FBQztJQUMxRCxNQUFNVSxJQUFJLEdBQUcsTUFBTSxJQUFBQyxzQkFBWSxFQUFDSCxHQUFHLENBQUM7SUFDcEMsTUFBTXdCLGNBQWMsR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQUN4QixJQUFJLENBQW1CO0lBQ3pELElBQUksQ0FBQ3NCLGNBQWMsQ0FBQ0csSUFBSSxJQUFJSCxjQUFjLENBQUNHLElBQUksSUFBSSxTQUFTLEVBQUU7TUFDNUQsTUFBTSxJQUFJMUQsS0FBSyxDQUFDLEdBQUdOLEdBQUcscUJBQXFCNkQsY0FBYyxDQUFDRyxJQUFJLGdCQUFnQkgsY0FBYyxDQUFDSSxPQUFPLEVBQUUsQ0FBQztJQUN6RztJQUVBLElBQUksQ0FBQ3hGLGVBQWUsR0FBR29GLGNBQWMsQ0FBQ2QsVUFBVTtJQUNoRCxPQUFPLElBQUlELHdCQUFXLENBQUM7TUFDckJoRSxTQUFTLEVBQUUrRSxjQUFjLENBQUNLLFdBQVc7TUFDckNuRixTQUFTLEVBQUU4RSxjQUFjLENBQUNaLGVBQWU7TUFDekNDLFlBQVksRUFBRVcsY0FBYyxDQUFDTTtJQUMvQixDQUFDLENBQUM7RUFDSjtFQUVRakYsZUFBZUEsQ0FBQSxFQUFHO0lBQ3hCLE1BQU1rRixTQUFTLEdBQUcsSUFBSTNDLElBQUksQ0FBQyxJQUFJLENBQUNoRCxlQUFlLENBQUM7SUFDaEQsTUFBTTRGLGlCQUFpQixHQUFHLElBQUk1QyxJQUFJLENBQUNBLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDLEVBQUM7SUFDM0QsT0FBTzJDLGlCQUFpQixHQUFHRCxTQUFTO0VBQ3RDO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQUFFLE9BQUEsQ0FBQS9GLGNBQUEsR0FBQUEsY0FBQTtBQUFBLElBQUFnRyxRQUFBLEdBQUFELE9BQUEsQ0FBQXhHLE9BQUEsR0FDZVMsY0FBYyIsImlnbm9yZUxpc3QiOltdfQ==